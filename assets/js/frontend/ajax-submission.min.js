jQuery(function(o){"use strict";o('form[data-ajax_submission="1"]').each(function(e,a){o(document).ready(function(){var r=o(a),i=r.find(".evf-submit");r.find("[data-gateway='razorpay']");i.on("click",function(e){var a=r.find(".everest-forms-stripe-gateways-tabs .evf-tab").has("a.active").data("gateway");if(undefined===a&&r.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway"),r.find(".everest-forms-gateway[data-gateway='stripe']").hasClass("StripeElement--empty")&&o(".evf-field-credit-card ").is(":visible"))return o("#card-errors").html("This field is required").show(),!1;"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();a=i.get(0).recaptchaID;if(0===a)return grecaptcha.execute(a),!1;a=r.serializeArray(),e.preventDefault(),r.trigger("focusout").trigger("change").trigger("submit"),e=r.find(".evf-error:visible");0<e.length?o([document.documentElement,document.body]).animate({scrollTop:e.last().offset().top},800):(o(this).html(r.data("process-text")),a.push({name:"action",value:"everest_forms_ajax_form_submission"}),a.push({name:"security",value:everest_forms_ajax_submission_params.evf_ajax_submission}),o.ajax({url:everest_forms_ajax_submission_params.ajax_url,type:"POST",data:a}).done(function(s,e,a){var t=s.data&&s.data.redirect_url?s.data.redirect_url:"";if(t)return r.trigger("reset"),void(window.location=t);if("success"===s.data.response||!0===s.success){let e="",a="";s.data.form_id!==undefined&&s.data.entry_id!==undefined&&1==s.data.pdf_download&&(e='<br><small><a href="/?page=evf-entries-pdf&form_id='+s.data.form_id+"&entry_id="+s.data.entry_id+'">'+s.data.pdf_download_message+"</a></small>"),1==s.data.quiz_result_shown&&(a=s.data.quiz_reporting);var t=r.find(".everest-forms-stripe-gateways-tabs .evf-tab").has("a.active").data("gateway");"stripe"===(t=undefined===t?"ideal"===(t=r.find(".everest-forms-gateway[data-gateway='ideal']").data("gateway"))?"ideal":r.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway"):t)&&"none"!==r.find(".everest-forms-gateway[data-gateway='stripe']").closest(".evf-field").css("display")?r.trigger("everest_forms_frontend_before_ajax_complete_success_message",s.data):"ideal"===(t=undefined===t?r.find(".everest-forms-gateway[data-gateway='ideal']").data("gateway"):t)&&"none"!==r.find(".everest-forms-gateway[data-gateway='ideal']").closest(".evf-field").css("display")?r.trigger("evf_process_payment",s.data):(r.trigger("reset"),r.closest(".everest-forms").html('<div class="everest-forms-notice everest-forms-notice--success" role="alert">'+s.data.message+e+"</div>"+a).focus(),localStorage.removeItem(r.attr("id")),t=new CustomEvent("everest_forms_ajax_submission_success",{detail:{formId:"evf-form-"+s.data.form_id}}),document.dispatchEvent(t))}else{var d=r.data("formid"),s=JSON.parse(a.responseText),a=(t="undefined"!=typeof s.data[d]?s.data[d].header:everest_forms_ajax_submission_params.error,s.data.error);"string"==typeof s.data.message&&(t=s.data.message),r.closest(".everest-forms").find(".everest-forms-notice").remove(),r.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+t+"</div>").focus(),o(a).each(function(e,a){var t,s=Object.values(a)[0],r=Object.keys(a)[0],a=!0,i="evf"-+d+"-field_"+r+"-container";o("#"+i).hasClass("evf-field-signature")?t=o("#"+("evf-signature-img-input-"+r)):o("#"+i).hasClass("evf-field-likert")?(a=!1,(t=o('[id^="'+("everest_forms-"+d+"-field_"+r+"_")+'"]')).each(function(e,a){var a=o(a).closest("tr.evf-"+d+"-field_"+r).find("th"),s="everest_forms[form_fields]["+r+"]["+(parseInt(a.closest("tr").index())+1)+"]";a.children().is("label")?a.children().find("#"+s).show():(a.parents("span.input-wrapper").length?a.parents("span.input-wrapper"):a).append('<label id="'+s+'" for="'+s+'" class="evf-error">'+everest_forms_ajax_submission_params.required+"</label>")})):o("#"+i).hasClass("evf-field-address")?(t=o('[id^="'+("evf-"+d+"-field_"+r)+'"]')).each(function(e,a){var s=String(o(a).attr("id"));(s.includes("-container")||s.includes("-address2")||void 0!==o(a).val())&&t.splice(e,1)}):t=o("#"+("evf-"+d+"-field_"+r)),t.addClass("evf-error"),t.attr("aria-invalid",!0),t.first().closest(".evf-field").addClass("everest-forms-invalid evf-has-error"),!0!==a||t.is("label")||(t.parents("span.input-wrapper").length?t.parents("span.input-wrapper"):t).after('<label id="'+t.attr("id")+'-error" class="evf-error" for="'+t.attr("id")+'">'+s+"</label>").show()}),i.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit)}}).fail(function(){i.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit),r.trigger("focusout").trigger("change"),r.closest(".everest-forms").find(".everest-forms-notice").remove(),r.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+everest_forms_ajax_submission_params.error+"</div>").focus()}).always(function(e){!(e.data&&e.data.redirect_url?e.data.redirect_url:"")&&o(".everest-forms-notice").length&&o([document.documentElement,document.body]).animate({scrollTop:o(".everest-forms-notice").offset().top},800)}))})})})});