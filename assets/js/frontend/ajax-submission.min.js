jQuery(function(d){"use strict";d('form[data-ajax_submission="1"]').each(function(e,r){d(document).ready(function(){var t=d(r),o=t.find(".evf-submit"),e=t.find("[data-gateway*='stripe']");0<e.length&&0===e.children.length||o.on("click",function(e){var r=t.serializeArray();e.preventDefault(),t.trigger("focusout").trigger("change").trigger("submit");e=t.find(".evf-error:visible");0<e.length?d([document.documentElement,document.body]).animate({scrollTop:e.last().offset().top},800):(d(this).html(t.data("process-text")),r.push({name:"action",value:"everest_forms_ajax_form_submission"}),r.push({name:"security",value:everest_forms_ajax_submission_params.evf_ajax_submission}),d.ajax({url:everest_forms_ajax_submission_params.ajax_url,type:"POST",data:r}).done(function(r,e,s){var a=r.data&&r.data.redirect_url?r.data.redirect_url:"";if(a)return t.trigger("reset"),void(window.location=a);if("success"===r.data.response||!0===r.success){let e="";r.data.form_id!==undefined&&r.data.entry_id!==undefined&&r.data.pdf_download!==undefined&&!0===r.data.pdf_download&&(e='<br><small><a href="/?page=evf-entries-pdf&form_id='+r.data.form_id+"&entry_id="+r.data.entry_id+'">'+everest_forms_ajax_submission_params.pdf_download+"</a></small>"),t.trigger("reset"),t.closest(".everest-forms").html('<div class="everest-forms-notice everest-forms-notice--success" role="alert">'+r.data.message+e+"</div>").focus()}else{var i=t.data("formid"),a=everest_forms_ajax_submission_params.error,r=JSON.parse(s.responseText),s=r.data.error;"string"==typeof r.data.message&&(a=r.data.message),t.closest(".everest-forms").find(".everest-forms-notice").remove(),t.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+a+"</div>").focus(),d(s).each(function(e,r){var a,t=Object.values(r)[0],s=!0;switch(Object.keys(r)[0]){case"signature":a=d("#"+("evf-signature-img-input-"+t));break;case"likert":s=!1,(a=d('[id^="'+("everest_forms-"+i+"-field_"+t+"_")+'"]')).each(function(e,r){var s=d(r).closest("tr.evf-"+i+"-field_"+t).find("th"),r="everest_forms[form_fields]["+t+"]["+(parseInt(s.closest("tr").index())+1)+"]";s.children().is("label")?s.children().find("#"+r).show():s.append('<label id="'+r+'" for="'+r+'" class="evf-error">'+everest_forms_ajax_submission_params.required+"</label>")});break;case"address":(a=d('[id^="'+("evf-"+i+"-field_"+t)+'"]')).each(function(e,r){var s=String(d(r).attr("id"));(s.includes("-container")||s.includes("-address2")||void 0!==d(r).val())&&a.splice(e,1)});break;default:a=d("#"+("evf-"+i+"-field_"+t))}a.addClass("evf-error"),a.attr("required",!0),a.attr("aria-invalid",!0),a.first().closest(".evf-field").addClass("everest-forms-invalid evf-has-error"),!0!==s||a.is("label")||a.after('<label id="'+a.attr("id")+'-error" class="evf-error" for="'+a.attr("id")+'">'+everest_forms_ajax_submission_params.required+"</label>").show()}),o.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit)}}).fail(function(){o.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit),t.trigger("focusout").trigger("change"),t.closest(".everest-forms").find(".everest-forms-notice").remove(),t.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+everest_forms_ajax_submission_params.error+"</div>").focus()}).always(function(e){!(e.data&&e.data.redirect_url?e.data.redirect_url:"")&&d(".everest-forms-notice").length&&d([document.documentElement,document.body]).animate({scrollTop:d(".everest-forms-notice").offset().top},800)}))})})})});