jQuery(function(d){"use strict";d('form[data-ajax_submission="1"]').each(function(e,s){d(document).ready(function(){var r=d(s),i=r.find(".evf-submit"),e=r.find("[data-gateway*='stripe']"),a=r.find("[data-gateway='razorpay']");0<e.length&&0===e.children.length||0<a.length||i.on("click",function(e){var a=r.find(".everest-forms-stripe-gateways-tabs .evf-tab").has("a.active").data("gateway");if("stripe"!==(a=undefined===a?r.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway"):a)||"none"===r.find(".everest-forms-gateway[data-gateway='ideal']").closest(".evf-field").css("display")){"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();a=i.get(0).recaptchaID;if(0===a)return grecaptcha.execute(a),!1;a=r.serializeArray(),e=(e.preventDefault(),r.trigger("focusout").trigger("change").trigger("submit"),r.find(".evf-error:visible"));0<e.length?d([document.documentElement,document.body]).animate({scrollTop:e.last().offset().top},800):(d(this).html(r.data("process-text")),a.push({name:"action",value:"everest_forms_ajax_form_submission"}),a.push({name:"security",value:everest_forms_ajax_submission_params.evf_ajax_submission}),d.ajax({url:everest_forms_ajax_submission_params.ajax_url,type:"POST",data:a}).done(function(s,e,a){var t=s.data&&s.data.redirect_url?s.data.redirect_url:"";if(t)return r.trigger("reset"),void(window.location=t);if("success"===s.data.response||!0===s.success){let e="",a="";s.data.form_id!==undefined&&s.data.entry_id!==undefined&&1==s.data.pdf_download&&(e='<br><small><a href="/?page=evf-entries-pdf&form_id='+s.data.form_id+"&entry_id="+s.data.entry_id+'">'+s.data.pdf_download_message+"</a></small>"),1==s.data.quiz_result_shown&&(a=s.data.quiz_reporting);t=r.find(".everest-forms-stripe-gateways-tabs .evf-tab").has("a.active").data("gateway");"ideal"===(t=undefined===t?r.find(".everest-forms-gateway[data-gateway='ideal']").data("gateway"):t)&&"none"!==r.find(".everest-forms-gateway[data-gateway='ideal']").closest(".evf-field").css("display")?r.trigger("evf_process_payment",s.data):(r.trigger("reset"),r.closest(".everest-forms").html('<div class="everest-forms-notice everest-forms-notice--success" role="alert">'+s.data.message+e+"</div>"+a).focus(),localStorage.removeItem(r.attr("id")))}else{var o=r.data("formid"),t=JSON.parse(a.responseText),a=(s="undefined"!=typeof t.data[o]?t.data[o].header:everest_forms_ajax_submission_params.error,t.data.error);"string"==typeof t.data.message&&(s=t.data.message),r.closest(".everest-forms").find(".everest-forms-notice").remove(),r.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+s+"</div>").focus(),d(a).each(function(e,a){var t,s=Object.values(a)[0],r=Object.keys(a)[0],a=!0,i="evf"-+o+"-field_"+r+"-container";d("#"+i).hasClass("evf-field-signature")?t=d("#"+("evf-signature-img-input-"+r)):d("#"+i).hasClass("evf-field-likert")?(a=!1,(t=d('[id^="'+("everest_forms-"+o+"-field_"+r+"_")+'"]')).each(function(e,a){var a=d(a).closest("tr.evf-"+o+"-field_"+r).find("th"),s="everest_forms[form_fields]["+r+"]["+(parseInt(a.closest("tr").index())+1)+"]";a.children().is("label")?a.children().find("#"+s).show():(a.parents("span.input-wrapper").length?a.parents("span.input-wrapper"):a).append('<label id="'+s+'" for="'+s+'" class="evf-error">'+everest_forms_ajax_submission_params.required+"</label>")})):d("#"+i).hasClass("evf-field-address")?(t=d('[id^="'+("evf-"+o+"-field_"+r)+'"]')).each(function(e,a){var s=String(d(a).attr("id"));(s.includes("-container")||s.includes("-address2")||void 0!==d(a).val())&&t.splice(e,1)}):t=d("#"+("evf-"+o+"-field_"+r)),t.addClass("evf-error"),t.attr("aria-invalid",!0),t.first().closest(".evf-field").addClass("everest-forms-invalid evf-has-error"),!0!==a||t.is("label")||(t.parents("span.input-wrapper").length?t.parents("span.input-wrapper"):t).after('<label id="'+t.attr("id")+'-error" class="evf-error" for="'+t.attr("id")+'">'+s+"</label>").show()}),i.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit)}}).fail(function(){i.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit),r.trigger("focusout").trigger("change"),r.closest(".everest-forms").find(".everest-forms-notice").remove(),r.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+everest_forms_ajax_submission_params.error+"</div>").focus()}).always(function(e){!(e.data&&e.data.redirect_url?e.data.redirect_url:"")&&d(".everest-forms-notice").length&&d([document.documentElement,document.body]).animate({scrollTop:d(".everest-forms-notice").offset().top},800)}))}})})})});