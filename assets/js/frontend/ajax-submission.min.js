jQuery(function(f){"use strict";f('form[data-ajax_submission="1"]').each(function(e,o){f(document).ready(function(){var d=f(o),n=d.find(".evf-submit");d.find("[data-gateway='razorpay']");n.on("click",async function(e){var a=d.find(".everest-forms-stripe-gateways-tabs .evf-tab").has("a.active").data("gateway");if(undefined===a&&d.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway"),d.find(".everest-forms-gateway[data-gateway='stripe']").hasClass("StripeElement--empty")&&f(".evf-field-credit-card ").is(":visible"))return f(document).ready(function(){f("#card-errors").html("This field is required").show(),f(".evf-submit").text("Submit"),f(".evf-submit").attr("disabled",!1)}),d.trigger("focusout").trigger("change").trigger("submit"),!1;var t,a=d.find(".everest-forms-gateway[data-gateway='square']").find(".sq-card-message-error");if(0<a.length)return t=a.text(),f(document).ready(function(){f("#card-errors").html(t).show(),f(".evf-submit").text("Submit"),f(".evf-submit").attr("disabled",!1)}),d.trigger("focusout").trigger("change").trigger("submit"),!1;"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();a=n.get(0).recaptchaID;if(0===a)return grecaptcha.execute(a),!1;a=d.serializeArray(),e.preventDefault(),d.trigger("focusout").trigger("change").trigger("submit"),e=d.find(".evf-error:visible");if(f(".everest-forms-authorize_net[data-gateway='authorize-net']").length){var r=window.EverestFormsAuthorizeNet.getCardData(d);if(!Object.values(r).some(e=>!e)){r=new Promise(function(e,a){window.EverestFormsAuthorizeNet.authorizeNetAjaxSubmitHandler(o).then(e)["catch"](a)});try{var s=await r;"Ok"===s.messages.resultCode&&a.push({name:"everest_forms[authorize_net][opaque_data][descriptor]",value:s.opaqueData.dataDescriptor},{name:"everest_forms[authorize_net][opaque_data][value]",value:s.opaqueData.dataValue})}catch(i){return}}e.length<1&&(e=d.parents("div.everest-forms").find(".everest-forms-notice.everest-forms-notice--error .evf-error"))}0<e.length?f([document.documentElement,document.body]).animate({scrollTop:e.last().offset().top},800):(f(this).html(d.data("process-text")),a.push({name:"action",value:"everest_forms_ajax_form_submission"}),a.push({name:"security",value:everest_forms_ajax_submission_params.evf_ajax_submission}),f.ajax({url:everest_forms_ajax_submission_params.ajax_url,type:"POST",data:a}).done(function(r,e,a){var s=r.data&&r.data.redirect_url?r.data.redirect_url:"";if(s&&"stripe"!==d.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway"))d.trigger("reset"),window.location=s;else if(r&&r.payment_method&&"paypal"===r.payment_method&&r.redirect&&"paypal"===r.payment_method)window.location.href=r.redirect;else if("success"===r.data.response||!0===r.success){let e="",a="",t="";r.data.form_id!==undefined&&r.data.entry_id!==undefined&&1==r.data.pdf_download&&(e='<br><small><a href="/?page=evf-entries-pdf&form_id='+r.data.form_id+"&entry_id="+r.data.entry_id+'">'+r.data.pdf_download_message+"</a></small>"),1==r.data.quiz_result_shown&&(a=r.data.quiz_reporting),"1"==r.data.is_preview_confirmation&&(t=r.data.preview_confirmation);var s=d.find(".everest-forms-stripe-gateways-tabs .evf-tab").has("a.active").data("gateway");"stripe"===(s=undefined===s?"ideal"===(s=d.find(".everest-forms-gateway[data-gateway='ideal']").data("gateway"))?"ideal":d.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway"):s)&&"none"!==d.find(".everest-forms-gateway[data-gateway='stripe']").closest(".evf-field").css("display")?d.trigger("everest_forms_frontend_before_ajax_complete_success_message",r.data):"ideal"===(s=undefined===s?d.find(".everest-forms-gateway[data-gateway='ideal']").data("gateway"):s)&&"none"!==d.find(".everest-forms-gateway[data-gateway='ideal']").closest(".evf-field").css("display")?d.trigger("evf_process_payment",r.data):"square"===d.find(".everest-forms-gateway[data-gateway='square']").data("gateway")?d.trigger("everest_forms_frontend_payment_before_success_message",r.data):(d.trigger("reset"),d.closest(".everest-forms").html('<div class="everest-forms-notice everest-forms-notice--success" role="alert">'+r.data.message+e+"</div>"+a+t).focus(),localStorage.removeItem(d.attr("id")),s=new CustomEvent("everest_forms_ajax_submission_success",{detail:{formId:"evf-form-"+r.data.form_id}}),document.dispatchEvent(s))}else{var o=d.data("formid"),r=JSON.parse(a.responseText),a=(s="undefined"!=typeof r.data[o]?r.data[o].header:everest_forms_ajax_submission_params.error,r.data.error);"string"==typeof r.data.message&&(s=r.data.message),d.closest(".everest-forms").find(".everest-forms-notice").remove(),d.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+s+"</div>").focus(),f(a).each(function(e,a){var r,t=Object.values(a)[0],s=Object.keys(a)[0],a=!0,i="evf"-+o+"-field_"+s+"-container";f("#"+i).hasClass("evf-field-signature")?r=f("#"+("evf-signature-img-input-"+s)):f("#"+i).hasClass("evf-field-likert")?(a=!1,(r=f('[id^="'+("everest_forms-"+o+"-field_"+s+"_")+'"]')).each(function(e,a){var a=f(a).closest("tr.evf-"+o+"-field_"+s).find("th"),t="everest_forms[form_fields]["+s+"]["+(parseInt(a.closest("tr").index())+1)+"]";a.children().is("label")?a.children().find("#"+t).show():(a.parents("span.input-wrapper").length?a.parents("span.input-wrapper"):a).append('<label id="'+t+'" for="'+t+'" class="evf-error">'+everest_forms_ajax_submission_params.required+"</label>")})):f("#"+i).hasClass("evf-field-address")?(r=f('[id^="'+("evf-"+o+"-field_"+s)+'"]')).each(function(e,a){var t=String(f(a).attr("id"));(t.includes("-container")||t.includes("-address2")||void 0!==f(a).val())&&r.splice(e,1)}):r=f("#"+("evf-"+o+"-field_"+s)),r.addClass("evf-error"),r.attr("aria-invalid",!0),r.first().closest(".evf-field").addClass("everest-forms-invalid evf-has-error"),!0!==a||r.is("label")||(r.parents("span.input-wrapper").length?r.parents("span.input-wrapper"):r).after('<label id="'+r.attr("id")+'-error" class="evf-error" for="'+r.attr("id")+'">'+t+"</label>").show()}),n.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit)}}).fail(function(){n.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit),d.trigger("focusout").trigger("change"),d.closest(".everest-forms").find(".everest-forms-notice").remove(),d.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+everest_forms_ajax_submission_params.error+"</div>").focus()}).always(function(e){!(e.data&&e.data.redirect_url?e.data.redirect_url:"")&&f(".everest-forms-notice").length&&f([document.documentElement,document.body]).animate({scrollTop:f(".everest-forms-notice").offset().top},800)}))})})})});