jQuery(function(n){"use strict";n('form[data-ajax_submission="1"]').each(function(e,o){n(document).ready(function(){var i=n(o),d=i.find(".evf-submit");i.find("[data-gateway='razorpay']");d.on("click",async function(e){var a=i.find(".everest-forms-stripe-gateways-tabs .evf-tab").has("a.active").data("gateway");if(undefined===a&&i.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway"),i.find(".everest-forms-gateway[data-gateway='stripe']").hasClass("StripeElement--empty")&&n(".evf-field-credit-card ").is(":visible"))return n(document).ready(function(){n("#card-errors").html("This field is required").show(),n(".evf-submit").text("Submit"),n(".evf-submit").attr("disabled",!1)}),i.trigger("focusout").trigger("change").trigger("submit"),!1;"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();a=d.get(0).recaptchaID;if(0===a)return grecaptcha.execute(a),!1;a=i.serializeArray(),e.preventDefault(),i.trigger("focusout").trigger("change").trigger("submit"),e=i.find(".evf-error:visible");if(n(".everest-forms-authorize_net[data-gateway='authorize-net']").length){var t=window.EverestFormsAuthorizeNet.getCardData(i);if(!Object.values(t).some(e=>!e)){t=new Promise(function(e,a){window.EverestFormsAuthorizeNet.authorizeNetAjaxSubmitHandler(o).then(e)["catch"](a)});try{var r=await t;"Ok"===r.messages.resultCode&&a.push({name:"everest_forms[authorize_net][opaque_data][descriptor]",value:r.opaqueData.dataDescriptor},{name:"everest_forms[authorize_net][opaque_data][value]",value:r.opaqueData.dataValue})}catch(s){return}}e.length<1&&(e=i.parents("div.everest-forms").find(".everest-forms-notice.everest-forms-notice--error .evf-error"))}0<e.length?n([document.documentElement,document.body]).animate({scrollTop:e.last().offset().top},800):(n(this).html(i.data("process-text")),a.push({name:"action",value:"everest_forms_ajax_form_submission"}),a.push({name:"security",value:everest_forms_ajax_submission_params.evf_ajax_submission}),n.ajax({url:everest_forms_ajax_submission_params.ajax_url,type:"POST",data:a}).done(function(t,e,a){var r=t.data&&t.data.redirect_url?t.data.redirect_url:"";if(r&&"stripe"!==i.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway"))i.trigger("reset"),window.location=r;else if("success"===t.data.response||!0===t.success){let e="",a="";t.data.form_id!==undefined&&t.data.entry_id!==undefined&&1==t.data.pdf_download&&(e='<br><small><a href="/?page=evf-entries-pdf&form_id='+t.data.form_id+"&entry_id="+t.data.entry_id+'">'+t.data.pdf_download_message+"</a></small>"),1==t.data.quiz_result_shown&&(a=t.data.quiz_reporting);var r=i.find(".everest-forms-stripe-gateways-tabs .evf-tab").has("a.active").data("gateway");"stripe"===(r=undefined===r?"ideal"===(r=i.find(".everest-forms-gateway[data-gateway='ideal']").data("gateway"))?"ideal":i.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway"):r)&&"none"!==i.find(".everest-forms-gateway[data-gateway='stripe']").closest(".evf-field").css("display")?i.trigger("everest_forms_frontend_before_ajax_complete_success_message",t.data):"ideal"===(r=undefined===r?i.find(".everest-forms-gateway[data-gateway='ideal']").data("gateway"):r)&&"none"!==i.find(".everest-forms-gateway[data-gateway='ideal']").closest(".evf-field").css("display")?i.trigger("evf_process_payment",t.data):(i.trigger("reset"),i.closest(".everest-forms").html('<div class="everest-forms-notice everest-forms-notice--success" role="alert">'+t.data.message+e+"</div>"+a).focus(),localStorage.removeItem(i.attr("id")),r=new CustomEvent("everest_forms_ajax_submission_success",{detail:{formId:"evf-form-"+t.data.form_id}}),document.dispatchEvent(r))}else{var o=i.data("formid"),t=JSON.parse(a.responseText),a=(r="undefined"!=typeof t.data[o]?t.data[o].header:everest_forms_ajax_submission_params.error,t.data.error);"string"==typeof t.data.message&&(r=t.data.message),i.closest(".everest-forms").find(".everest-forms-notice").remove(),i.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+r+"</div>").focus(),n(a).each(function(e,a){var r,t=Object.values(a)[0],s=Object.keys(a)[0],a=!0,i="evf"-+o+"-field_"+s+"-container";n("#"+i).hasClass("evf-field-signature")?r=n("#"+("evf-signature-img-input-"+s)):n("#"+i).hasClass("evf-field-likert")?(a=!1,(r=n('[id^="'+("everest_forms-"+o+"-field_"+s+"_")+'"]')).each(function(e,a){var a=n(a).closest("tr.evf-"+o+"-field_"+s).find("th"),t="everest_forms[form_fields]["+s+"]["+(parseInt(a.closest("tr").index())+1)+"]";a.children().is("label")?a.children().find("#"+t).show():(a.parents("span.input-wrapper").length?a.parents("span.input-wrapper"):a).append('<label id="'+t+'" for="'+t+'" class="evf-error">'+everest_forms_ajax_submission_params.required+"</label>")})):n("#"+i).hasClass("evf-field-address")?(r=n('[id^="'+("evf-"+o+"-field_"+s)+'"]')).each(function(e,a){var t=String(n(a).attr("id"));(t.includes("-container")||t.includes("-address2")||void 0!==n(a).val())&&r.splice(e,1)}):r=n("#"+("evf-"+o+"-field_"+s)),r.addClass("evf-error"),r.attr("aria-invalid",!0),r.first().closest(".evf-field").addClass("everest-forms-invalid evf-has-error"),!0!==a||r.is("label")||(r.parents("span.input-wrapper").length?r.parents("span.input-wrapper"):r).after('<label id="'+r.attr("id")+'-error" class="evf-error" for="'+r.attr("id")+'">'+t+"</label>").show()}),d.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit)}}).fail(function(){d.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit),i.trigger("focusout").trigger("change"),i.closest(".everest-forms").find(".everest-forms-notice").remove(),i.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+everest_forms_ajax_submission_params.error+"</div>").focus()}).always(function(e){!(e.data&&e.data.redirect_url?e.data.redirect_url:"")&&n(".everest-forms-notice").length&&n([document.documentElement,document.body]).animate({scrollTop:n(".everest-forms-notice").offset().top},800)}))})})})});