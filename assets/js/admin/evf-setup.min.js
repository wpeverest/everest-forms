jQuery(function(u){var m={$setup_form:u(".everest-forms-setup--form"),$button_install:evf_data.i18n_activating,init:function(){this.title_focus(),u(document).on("click",".everest-forms-template-install-addon",this.install_addon),u(document).on("click",".everest-forms-builder-setup .upgrade-modal",this.message_upgrade),u(document).on("click",".everest-forms-builder-setup .evf-template-preview",this.template_preview),u(document).on("click",".activate-now",function(e){e.preventDefault(),u(this).closest("body.everest-forms_page_evf-builder").length&&m.active_addon_from_buidler(u(this))}),u(document).on("click",".install-from-builder",function(e){e.preventDefault(),u(this).closest("body.everest-forms_page_evf-builder").length&&m.install_now_from_buidler(u(this))}),this.$setup_form.on("click",".evf-template-select",this.template_select),u(document.body).on("keypress",".everest-forms-setup-form-name input",this.input_keypress),u(document.body).on("keypress","input#everest-forms-setup-name",function(e){"Enter"===e.key&&(e.preventDefault(),u(this).parents("div.jconfirm-content-pane").next("div.jconfirm-buttons").find("button.everest-forms-btn.everest-forms-btn-primary").trigger("click"))})},title_focus:function(){setTimeout(function(){u("#everest-forms-setup-name").focus()},100)},install_addon:function(e){var t=u(".plugins-list-table").find("#the-list tr"),n=u(e.target),r=0,o=0,i=[];wp.updates.maybeRequestFilesystemCredentials(e),u(".everest-forms-template-install-addon").html('<div class="evf-loading evf-loading-active"></div>'+m.$button_install).prop("disabled",!0),u(document).trigger("wp-plugin-bulk-install",t),t.each(function(e,t){t=u(t);t.hasClass("inactive")&&!t.find("notice-error").length&&wp.updates.queue.push({action:"everest_forms_install_extension",data:{page:pagenow,name:t.data("name"),slug:t.data("slug")}})}),u(document).on("wp-plugin-bulk-install-success wp-plugin-bulk-install-error",function(e,t){var s,a=u('[data-slug="'+t.slug+'"]');"wp-"+t.install+"-bulk-install-success"===e.type?r++:(e=t.pluginName||a.find(".plugin-name").text(),o++,i.push(e+": "+t.errorMessage)),wp.updates.adminNotice=wp.template("wp-bulk-installs-admin-notice"),u(".everest-forms-recommend-addons .bulk-action-notice").remove(),u(".everest-forms-recommend-addons .plugins-info").after(wp.updates.adminNotice({id:"bulk-action-notice",className:"bulk-action-notice notice-alt",successes:r,errors:o,errorMessages:i,type:t.install})),s=u("#bulk-action-notice").on("click","button",function(){u(this).toggleClass("bulk-action-errors-collapsed").attr("aria-expanded",!u(this).hasClass("bulk-action-errors-collapsed")),s.find(".bulk-action-errors").toggleClass("hidden")}),wp.updates.queue.length||0<o&&n.removeClass("updating-message").text(n.data("originaltext")),0===wp.updates.queue.length&&(u(".everest-forms-template-install-addon").remove(),u(".everest-forms-builder-setup .jconfirm-buttons button").show())}),wp.updates.queueChecker()},message_upgrade:function(e){var t=u(this).data("template-name-raw");e.preventDefault(),u.alert({title:t+" "+evf_setup_params.upgrade_title,theme:"jconfirm-modern jconfirm-everest-forms",icon:"dashicons dashicons-lock",backgroundDismiss:!1,scrollToPreviousElement:!1,content:evf_setup_params.upgrade_message,type:"red",boxWidth:"565px",buttons:{confirm:{text:evf_setup_params.upgrade_button,btnClass:"btn-confirm",keys:["enter"],action:function(){window.open(evf_setup_params.upgrade_url,"_blank")}},cancel:{text:evf_data.i18n_ok}}})},template_preview:function(){var e=u(this),t=e.data("preview-link");e.closest(".everest-forms-setup--form").find(".evf-template-preview-iframe #frame").attr("src",t)},template_select:function(e){var a=u(this),n=a.data("template"),r=a.data("template-name-raw"),o="",i=evf_setup_params.i18n_form_name,l='<input autofocus="" type="text" id="everest-forms-setup-name" class="everest-forms-setup-name" placeholder="'+evf_setup_params.i18n_form_placeholder+'">',c='<p class="error">'+evf_setup_params.i18n_form_error_name+"</p>";e.preventDefault(),($target=u(e.target)).hasClass("disabled")||$target.hasClass("updating-message")||u.confirm({title:evf_setup_params.i18n_form_title,theme:"jconfirm-modern jconfirm-everest-forms-left",backgroundDismiss:!1,scrollToPreviousElement:!1,content:function(){var e,t=this,s=evf_data.i18n_install_only;return $target.closest(".evf-template").find("span.everest-forms-badge").length?(e={action:"everest_forms_template_licence_check",plan:a.attr("data-licence-plan").replace("-lifetime",""),slug:a.attr("data-template"),security:evf_setup_params.template_licence_check_nonce},u.ajax({url:evf_email_params.ajax_url,data:e,type:"POST"}).done(function(e){t.setContentAppend(i+l+c+e.data.html),e.data.activate?u(".everest-forms-builder-setup .jconfirm-buttons button").show():(e.data.html.includes("install-now")&&(s=evf_data.i18n_install_activate,m.$button_install=evf_data.i18n_installing),e='<a href="#" class="everest-forms-btn everest-forms-btn-primary everest-forms-template-install-addon">'+s+"</a>",u(".everest-forms-builder-setup .jconfirm-buttons").append(e))})):(u(".everest-forms-builder-setup .jconfirm-buttons button").show(),i+l+c)},buttons:{Continue:{isHidden:!0,btnClass:"everest-forms-btn everest-forms-btn-primary",action:function(){var e=u("#everest-forms-setup-name"),t=u(".everest-forms-loader-overlay");if(console.log(e.val()),!e.val()||""===e.val().trim())return o=r,s=this.$content.find(".error"),u(".everest-forms-setup-name").addClass("everest-forms-required").focus(),s.show(),!1;o=e.val(),t.show();var s={title:o,action:"everest_forms_create_form",template:n,security:evf_setup_params.create_form_nonce};u.post(evf_setup_params.ajax_url,s,function(e){e.success?window.location.href=e.data.redirect:(t.hide(),u(".everest-forms-setup-name").addClass("everest-forms-required").focus(),window.console.log(e))}).fail(function(e){window.console.log(e.responseText)})}}}})},input_keypress:function(e){var t=e.keyCode||e.which;if(u(this).removeClass("everest-forms-required"),13===t&&"input"===e.target.tagName.toLowerCase())return e.preventDefault(),!1},active_addon_from_buidler:function(e){u(e).attr("href");var e=u(e).data("plugin"),t=u.alert({title:evf_setup_params.activate_title,theme:"jconfirm-modern jconfirm-everest-forms",icon:"dashicons dashicons-success",buttons:!1,content:evf_setup_params.activate_message,type:"green"});u.ajax({type:"POST",url:evf_setup_params.ajax_url,data:{action:"everest_forms_active_addons",plugin_file:e,security:evf_setup_params.evf_active_nonce},success:function(e){t.close(),!0===e.success?u.confirm({title:evf_setup_params.active_confirmation_title,theme:"jconfirm-modern jconfirm-everest-forms",icon:"success",backgroundDismiss:!1,scrollToPreviousElement:!1,type:"green",content:evf_setup_params.active_confirmation_message,buttons:{confirm:{text:evf_setup_params.save_changes_text,btnClass:"btn-warning",action:function(){u(".everest-forms-save-button").trigger("click"),location.reload(!0)}},cancel:{text:evf_setup_params.reload_text,btnClass:"btn-warning",action:function(){location.reload(!0)}}}}):u.alert({title:evf_setup_params.activate_title,theme:"jconfirm-modern jconfirm-everest-forms",icon:"dashicons dashicons-warning",buttons:!1,content:e.data.message,type:"red"})}})},install_now_from_buidler:function(e){var s=u.alert({title:evf_setup_params.installing_title,icon:"success",buttons:!1,content:evf_setup_params.installing_message,type:"green"});wp.updates.maybeRequestFilesystemCredentials(e),m.$button_install=evf_setup_params.i18n_installing,u(e).html(m.$button_install+'<div class="ur-spinner"></div>').closest("button").prop("disabled",!0),wp.updates.queue.push({action:"everest_forms_install_extension",data:{page:pagenow,name:u(e).data("name"),slug:u(e).data("slug")}}),u(document).on("wp-plugin-install-success wp-plugin-install-error",function(e,t){s.close(),"undefined"!=typeof t.errorMessage&&0<t.errorMessage.length?u.alert({title:t.errorMessage,content:evf_setup_params.download_failed,icon:"error"}):0===wp.updates.queue.length&&u.alert({title:evf_setup_params.install_confirmation_title,theme:"jconfirm-modern jconfirm-everest-forms",icon:"success",backgroundDismiss:!1,scrollToPreviousElement:!1,content:evf_setup_params.install_confirmation_message,buttons:{confirm:{text:evf_setup_params.save_changes_text,btnClass:"btn-warning",action:function(){u(".everest-forms-save-button").trigger("click"),location.reload()}},cancel:{text:evf_setup_params.reload_text,btnClass:"btn-warning",action:function(){location.reload()}}},type:"green"})}),wp.updates.queueChecker()}};m.init()});