jQuery(function(m){var p={$setup_form:m(".everest-forms-setup--form"),$button_install:evf_data.i18n_activating,init:function(){this.title_focus(),m(document).on("click",".everest-forms-template-install-addon",this.install_addon),m(document).on("click",".everest-forms-builder-setup .upgrade-modal",this.message_upgrade),m(document).on("click",".everest-forms-builder-setup .evf-template-preview",this.template_preview),this.$setup_form.on("click",".evf-template-select",this.template_select),m(document.body).on("keypress",".everest-forms-setup-form-name input",this.input_keypress),m(document.body).on("keypress","input#everest-forms-setup-name",function(e){"Enter"===e.key&&(e.preventDefault(),m(this).parents("div.jconfirm-content-pane").next("div.jconfirm-buttons").find("button.everest-forms-btn.everest-forms-btn-primary").trigger("click"))})},title_focus:function(){setTimeout(function(){m("#everest-forms-setup-name").focus()},100)},install_addon:function(e){var t=m(".plugins-list-table").find("#the-list tr"),n=m(e.target),r=0,o=0,i=[];wp.updates.maybeRequestFilesystemCredentials(e),m(".everest-forms-template-install-addon").html('<div class="evf-loading evf-loading-active"></div>'+p.$button_install).prop("disabled",!0),m(document).trigger("wp-plugin-bulk-install",t),t.each(function(e,t){t=m(t);t.hasClass("inactive")&&!t.find("notice-error").length&&wp.updates.queue.push({action:"everest_forms_install_extension",data:{page:pagenow,name:t.data("name"),slug:t.data("slug")}})}),m(document).on("wp-plugin-bulk-install-success wp-plugin-bulk-install-error",function(e,t){var s,a=m('[data-slug="'+t.slug+'"]');"wp-"+t.install+"-bulk-install-success"===e.type?r++:(e=t.pluginName||a.find(".plugin-name").text(),o++,i.push(e+": "+t.errorMessage)),wp.updates.adminNotice=wp.template("wp-bulk-installs-admin-notice"),m(".everest-forms-recommend-addons .bulk-action-notice").remove(),m(".everest-forms-recommend-addons .plugins-info").after(wp.updates.adminNotice({id:"bulk-action-notice",className:"bulk-action-notice notice-alt",successes:r,errors:o,errorMessages:i,type:t.install})),s=m("#bulk-action-notice").on("click","button",function(){m(this).toggleClass("bulk-action-errors-collapsed").attr("aria-expanded",!m(this).hasClass("bulk-action-errors-collapsed")),s.find(".bulk-action-errors").toggleClass("hidden")}),wp.updates.queue.length||0<o&&n.removeClass("updating-message").text(n.data("originaltext")),0===wp.updates.queue.length&&(m(".everest-forms-template-install-addon").remove(),m(".everest-forms-builder-setup .jconfirm-buttons button").show())}),wp.updates.queueChecker()},message_upgrade:function(e){var t=m(this).data("template-name-raw");e.preventDefault(),m.alert({title:t+" "+evf_setup_params.upgrade_title,theme:"jconfirm-modern jconfirm-everest-forms",icon:"dashicons dashicons-lock",backgroundDismiss:!1,scrollToPreviousElement:!1,content:evf_setup_params.upgrade_message,type:"red",boxWidth:"565px",buttons:{confirm:{text:evf_setup_params.upgrade_button,btnClass:"btn-confirm",keys:["enter"],action:function(){window.open(evf_setup_params.upgrade_url,"_blank")}},cancel:{text:evf_data.i18n_ok}}})},template_preview:function(){var e=m(this),t=e.data("preview-link");e.closest(".everest-forms-setup--form").find(".evf-template-preview-iframe #frame").attr("src",t)},template_select:function(e){var a=m(this),n=a.data("template"),r=a.data("template-name-raw"),o="",i=evf_setup_params.i18n_form_name,l='<input autofocus="" type="text" id="everest-forms-setup-name" class="everest-forms-setup-name" placeholder="'+evf_setup_params.i18n_form_placeholder+'">',u='<p class="error">'+evf_setup_params.i18n_form_error_name+"</p>";e.preventDefault(),($target=m(e.target)).hasClass("disabled")||$target.hasClass("updating-message")||m.confirm({title:evf_setup_params.i18n_form_title,theme:"jconfirm-modern jconfirm-everest-forms-left",backgroundDismiss:!1,scrollToPreviousElement:!1,content:function(){var e,t=this,s=evf_data.i18n_install_only;return $target.closest(".evf-template").find("span.everest-forms-badge").length?(e={action:"everest_forms_template_licence_check",plan:a.attr("data-licence-plan").replace("-lifetime",""),slug:a.attr("data-template"),security:evf_setup_params.template_licence_check_nonce},m.ajax({url:evf_email_params.ajax_url,data:e,type:"POST"}).done(function(e){t.setContentAppend(i+l+u+e.data.html),e.data.activate?m(".everest-forms-builder-setup .jconfirm-buttons button").show():(e.data.html.includes("install-now")&&(s=evf_data.i18n_install_activate,p.$button_install=evf_data.i18n_installing),e='<a href="#" class="everest-forms-btn everest-forms-btn-primary everest-forms-template-install-addon">'+s+"</a>",m(".everest-forms-builder-setup .jconfirm-buttons").append(e))})):(m(".everest-forms-builder-setup .jconfirm-buttons button").show(),i+l+u)},buttons:{Continue:{isHidden:!0,btnClass:"everest-forms-btn everest-forms-btn-primary",action:function(){var e=m("#everest-forms-setup-name"),t=m(".everest-forms-loader-overlay");if(console.log(e.val()),!e.val()||""===e.val().trim())return o=r,s=this.$content.find(".error"),m(".everest-forms-setup-name").addClass("everest-forms-required").focus(),s.show(),!1;o=e.val(),t.show();var s={title:o,action:"everest_forms_create_form",template:n,security:evf_setup_params.create_form_nonce};m.post(evf_setup_params.ajax_url,s,function(e){e.success?window.location.href=e.data.redirect:(t.hide(),m(".everest-forms-setup-name").addClass("everest-forms-required").focus(),window.console.log(e))}).fail(function(e){window.console.log(e.responseText)})}}}})},input_keypress:function(e){var t=e.keyCode||e.which;if(m(this).removeClass("everest-forms-required"),13===t&&"input"===e.target.tagName.toLowerCase())return e.preventDefault(),!1}};p.init()});