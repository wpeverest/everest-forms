!function(c){var t,n={settings:{form:c("#everest-forms-builder-form"),spinner:'<i class="evf-loading evf-loading-active" />'},init:function(){t=this.settings,c(".everest-forms-active-email-connections-list li").first().addClass("active-user"),c(".evf-content-email-settings-inner").first().addClass("active-connection"),n.bindUIActions()},ready:function(){t.formID=c("#everest-forms-builder-form").data("id")},bindUIActions:function(){c(document).on("click",".everest-forms-email-add",function(e){n.connectionAdd(this,e)}),c(document).on("click",".everest-forms-active-email-connections-list li",function(e){n.selectActiveAccount(this,e)}),c(document).on("click",".email-remove",function(e){n.removeAccount(this,e)}),c(document).on("click",".email-default-remove",function(e){n.removeDefaultAccount(this,e)}),c(document).on("input",".everest-forms-email-name input",function(e){n.renameConnection(this,e)}),c(document).on("focusin",".everest-forms-email-name input",function(e){n.focusConnectionName(this,e)})},connectionAdd:function(e,n){n.preventDefault();var a=c(e),o=a.closest(".everest-forms-panel-sidebar-content"),n=(a.parent(),a.data("type")),e=(e=evf_email_params.i18n_email_connection+('<input autofocus="" type="text" id="provider-connection-name" placeholder="'+evf_email_params.i18n_email_placeholder+'">')+('<p class="error">'+evf_email_params.i18n_email_error_name+"</p>")).replace(/%type%/g,n);c.confirm({title:!1,content:e,icon:"dashicons dashicons-info",type:"blue",backgroundDismiss:!1,closeIcon:!1,buttons:{confirm:{text:evf_email_params.i18n_email_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){var e=this.$content.find("input#provider-connection-name"),n=this.$content.find(".error"),e=e.val().trim();if(0===e.length)return n.show(),!1;var i=e,e={action:"everest_forms_new_email_add",source:"email",name:i,id:t.form.data("id"),security:evf_email_params.ajax_email_nonce};c.ajax({url:evf_email_params.ajax_url,data:e,type:"POST",success:function(e){var n=c("#everest-forms-panel-field-settings-form_title:first").val()+"-"+Date.now(),t=c(".evf-content-email-settings").first().clone();c(".evf-content-email-settings-inner").removeClass("active-connection"),t.find('input:not(#qt_everest_forms_panel_field_email_connection_1_evf_email_message_toolbar input[type="button"], .evf_conditional_logic_container input)').val(""),t.find('.evf_conditional_logic_container input[type="checkbox"]').prop("checked",!1),t.find('.everest-forms-attach-pdf-to-admin-email input[type="checkbox"]').prop("checked",!1),t.find('.everest-forms-show-header-in-attachment-pdf-file input[type="checkbox"]').prop("checked",!1),t.find(".everest-forms-show-header-in-attachment-pdf-file").hide(),t.find(".everest-forms-show-pdf-file-name").hide(),t.find(".evf-field-conditional-container").hide(),t.find(".evf-field-conditional-wrapper li:not(:first)").remove(),t.find(".conditional_or:not(:first)").remove(),t.find(".everest-forms-email-name input").val(i),setTimeout(function(){t.find(".evf-field-conditional-input").val("")},2e3),t.find(".evf-content-email-settings-inner").attr("data-connection_id",e.data.connection_id),t.find(".evf-content-email-settings-inner").removeClass("everest-forms-hidden"),t.find(".evf-toggle-switch input").attr("name","settings[email]["+e.data.connection_id+"][enable_email_notification]"),t.find(".evf-toggle-switch input:checkbox").attr("data-connection-id",e.data.connection_id),t.find(".evf-toggle-switch input:checkbox").prop("checked",!0),t.find(".evf-toggle-switch input:checkbox").val("1"),c(".evf-content-section-title").css("display","none"),c(".email-disable-message").remove(),t.find(".email-disable-message").remove(),t.find(".evf-toggle-switch").parents(".evf-content-section-title").css("display","flex"),t.find(".evf-field-conditional-container").attr("data-connection_id",e.data.connection_id),t.find("#everest-forms-panel-field-email-connection_1-connection_name").attr("name","settings[email]["+e.data.connection_id+"][connection_name]"),t.find("#everest-forms-panel-field-email-connection_1-evf_to_email").attr("name","settings[email]["+e.data.connection_id+"][evf_to_email]"),t.find("#everest-forms-panel-field-email-connection_1-evf_to_email").val("{admin_email}"),t.find("#everest-forms-panel-field-email-connection_1-evf_carboncopy").attr("name","settings[email]["+e.data.connection_id+"][evf_carboncopy]"),t.find("#everest-forms-panel-field-email-connection_1-evf_blindcarboncopy").attr("name","settings[email]["+e.data.connection_id+"][evf_blindcarboncopy]"),t.find("#everest-forms-panel-field-email-connection_1-evf_from_name").attr("name","settings[email]["+e.data.connection_id+"][evf_from_name]"),t.find("#everest-forms-panel-field-email-connection_1-evf_from_name").val(evf_email_params.from_name),t.find("#everest-forms-panel-field-email-connection_1-evf_from_email").attr("name","settings[email]["+e.data.connection_id+"][evf_from_email]"),t.find("#everest-forms-panel-field-email-connection_1-evf_from_email").val("{admin_email}"),t.find("#everest-forms-panel-field-email-connection_1-evf_reply_to").attr("name","settings[email]["+e.data.connection_id+"][evf_reply_to]"),t.find("#everest-forms-panel-field-email-connection_1-evf_email_subject").attr("name","settings[email]["+e.data.connection_id+"][evf_email_subject]"),t.find("#everest-forms-panel-field-email-connection_1-evf_email_subject").val(evf_email_params.email_subject),t.find("#everest_forms_panel_field_email_connection_1_evf_email_message").attr("name","settings[email]["+e.data.connection_id+"][evf_email_message]"),t.find("#everest_forms_panel_field_email_connection_1_evf_email_message").val("{all_fields}"),t.find("#everest-forms-panel-field-settingsemailconnection_1-attach_pdf_to_admin_email").attr("name","settings[email]["+e.data.connection_id+"][attach_pdf_to_admin_email]"),t.find("#everest-forms-panel-field-settingsemailconnection_1-attach_pdf_to_admin_email").val(1),t.find("#everest-forms-panel-field-settingsemailconnection_1-attach_pdf_to_admin_email").attr("id","everest-forms-panel-field-settingsemail"+e.data.connection_id+"-attach_pdf_to_admin_email"),t.find('label[for="everest-forms-panel-field-settingsemailconnection_1-attach_pdf_to_admin_email"]').attr("for","everest-forms-panel-field-settingsemail"+e.data.connection_id+"-attach_pdf_to_admin_email"),t.find('input[name="settings[email][connection_1][attach_pdf_to_admin_email]"]').remove(),t.find("#everest-forms-panel-field-settingsemailconnection_1-show_header_in_attachment_pdf_file").attr("name","settings[email]["+e.data.connection_id+"][show_header_in_attachment_pdf_file]"),t.find("#everest-forms-panel-field-settingsemailconnection_1-show_header_in_attachment_pdf_file").val(1),t.find("#everest-forms-panel-field-settingsemailconnection_1-show_header_in_attachment_pdf_file").attr("id","everest-forms-panel-field-settingsemail"+e.data.connection_id+"-show_header_in_attachment_pdf_file"),t.find('label[for="everest-forms-panel-field-settingsemailconnection_1-show_header_in_attachment_pdf_file"]').attr("for","everest-forms-panel-field-settingsemail"+e.data.connection_id+"-show_header_in_attachment_pdf_file"),t.find('input[name="settings[email][connection_1][show_header_in_attachment_pdf_file]"]').remove(),t.find("#everest-forms-panel-field-settingsemailconnection_1-pdf_name").attr("name","settings[email]["+e.data.connection_id+"][pdf_name]"),t.find("#everest-forms-panel-field-settingsemailconnection_1-pdf_name").val(n),t.find("#everest-forms-panel-field-settingsemailconnection_1-pdf_name").attr("id","everest-forms-panel-field-settingsemail"+e.data.connection_id+"-pdf_name"),t.find(".everest-forms-attach-pdf-to-admin-email").attr("id","everest-forms-panel-field-settingsemailconnection_"+e.data.connection_id+"-attach_pdf_to_admin_email-wrap"),t.find(".everest-forms-show-header-in-attachment-pdf-file ").attr("id","everest-forms-panel-field-settingsemailconnection_"+e.data.connection_id+"-show_header_in_attachment_pdf_file-wrap"),t.find("#everest-forms-panel-field-email-connection_1-conditional_logic_status").attr("name","settings[email]["+e.data.connection_id+"][conditional_logic_status]"),t.find('.evf_conditional_logic_container input[type="hidden"]').attr("name","settings[email]["+e.data.connection_id+"][conditional_logic_status]"),t.find(".evf-field-show-hide").attr("name","settings[email]["+e.data.connection_id+"][conditional_option]"),t.find(".evf-field-conditional-field-select").attr("name","settings[email]["+e.data.connection_id+"][conditionals][1][1][field]"),t.find(".evf-field-conditional-condition").attr("name","settings[email]["+e.data.connection_id+"][conditionals][1][1][operator]"),t.find(".evf-field-conditional-input").attr("name","settings[email]["+e.data.connection_id+"][conditionals][1][1][value]"),$cloned_email=t.append('<input type="hidden" name="settings[email]['+e.data.connection_id+'][connection_name]" value="'+i+'">'),c(".evf-email-settings-wrapper").append(t),o.find(".evf-content-email-settings-inner").last().addClass("active-connection"),a.parent().find(".everest-forms-active-email-connections-list li").removeClass("active-user"),a.closest(".everest-forms-active-email.active").children(".everest-forms-active-email-connections-list").removeClass("empty-list"),a.parent().find(".everest-forms-active-email-connections-list ").append('<li class="connection-list active-user" data-connection-id= "'+e.data.connection_id+'"><a class="user-nickname" href="#">'+i+'</a><a href="#"><span class="email-remove">Remove</span></a></li>')}})}},cancel:{text:evf_email_params.i18n_email_cancel}}})},selectActiveAccount:function(e,n){n.preventDefault();var t=c(e),n=t.data("connection-id"),e=c(".evf-content-email-settings").find('[data-connection_id="'+n+'"]'),n=c(e).length;c(".evf-content-email-settings").find(".evf-content-email-settings-inner").removeClass("active-connection"),c(".evf-content-section-title").has("[data-connection-id="+t.siblings(".active-user").attr("data-connection-id")+"]").css("display","none"),t.siblings().removeClass("active-user"),t.addClass("active-user"),n&&c(e).addClass("active-connection"),c(".email-disable-message").remove(),0==c("input[data-connection-id="+t.attr("data-connection-id")+"]:last").prop("checked")&&c('<p class="email-disable-message everest-forms-notice everest-forms-notice-info">'+evf_data.i18n_email_disable_message+"</p>").insertAfter(c(".evf-content-section-title").has("[data-connection-id="+t.attr("data-connection-id")+"]")),c(".evf-content-section-title").has("[data-connection-id="+t.attr("data-connection-id")+"]").css("display","flex")},removeAccount:function(e,n){n.preventDefault();var t=c(e),i=t.parent().parent().data("connection-id"),a=c(".evf-content-email-settings").find('[data-connection_id="'+i+'"]'),o=c(a).length;c.confirm({title:!1,content:"Are you sure you want to delete this Email?",backgroundDismiss:!1,closeIcon:!1,icon:"dashicons dashicons-info",type:"orange",buttons:{confirm:{text:evf_email_params.i18n_email_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){var e;o&&(e=t.parent().parent(),active_block_after=c(".evf-provider-connections").find('[data-connection_id="'+i+'"]'),lengthOfActiveBlockAfter=c(a).length,(e.prev().length?e.prev(".connection-list"):e.next(".connection-list")).trigger("click"),c(a).parent().remove(),e.remove())}},cancel:{text:evf_email_params.i18n_email_cancel}}})},removeDefaultAccount:function(e,n){n.preventDefault,c.alert({title:!1,content:"Default Email can not be deleted !",icon:"dashicons dashicons-info",type:"blue",buttons:{ok:{text:evf_data.i18n_ok,btnClass:"btn-confirm",keys:["enter"]}}})},focusConnectionName:function(e,n){e=c(e);e.data("val",e.val().trim())},renameConnection:function(e,n){n.preventDefault;var t=c(e),e=t.closest(".evf-content-email-settings-inner").data("connection_id");$active_block=c(".everest-forms-active-email-connections-list").find('[data-connection-id="'+e+'"]'),$active_block.find(".user-nickname").text(t.val()),0===t.val().trim().length&&(t.parent(".everest-forms-email-name").find(".everest-forms-error").remove(),t.parent(".everest-forms-email-name").append('<p class="everest-forms-error everest-forms-text-danger">Email name cannot be empty.</p>'),t.next(".everest-forms-error").fadeOut(3e3),setTimeout(function(){0===t.val().length&&(t.val(t.data("val")),$active_block.find(".user-nickname").text(t.data("val")))},3e3))}};n.init()}(jQuery);