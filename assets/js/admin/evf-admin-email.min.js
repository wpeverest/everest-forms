!function(s){var a,o={settings:{form:s("#everest-forms-builder-form"),spinner:'<i class="evf-loading evf-loading-active" />'},init:function(){a=this.settings,s(".everest-forms-active-email-connections-list li").first().addClass("active-user"),s(".evf-content-email-settings-inner").first().addClass("active-connection"),o.bindUIActions()},ready:function(){a.formID=s("#everest-forms-builder-form").data("id")},bindUIActions:function(){s(document).on("click",".everest-forms-email-add",function(e){o.connectionAdd(this,e)}),s(document).on("click",".everest-forms-active-email-connections-list li",function(e){o.selectActiveAccount(this,e)}),s(document).on("click",".email-remove",function(e){o.removeAccount(this,e)}),s(document).on("click",".email-default-remove",function(e){o.removeDefaultAccount(this,e)}),s(document).on("input",".everest-forms-email-name input",function(e){o.renameConnection(this,e)}),s(document).on("focusin",".everest-forms-email-name input",function(e){o.focusConnectionName(this,e)}),s(document).on("createEmailConnection",".everest-forms-email-add",function(e,n){o.addNewEmailConnection(s(this),n)})},connectionAdd:function(e,n){n.preventDefault();var i=s(e),n=i.data("type"),e=(e=evf_email_params.i18n_email_connection+('<input autofocus="" type="text" id="provider-connection-name" placeholder="'+evf_email_params.i18n_email_placeholder+'">')+('<p class="error">'+evf_email_params.i18n_email_error_name+"</p>")).replace(/%type%/g,n);s.confirm({title:!1,content:e,icon:"dashicons dashicons-info",type:"blue",backgroundDismiss:!1,closeIcon:!1,buttons:{confirm:{text:evf_email_params.i18n_email_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){var e=this.$content.find("input#provider-connection-name"),n=this.$content.find(".error"),e=e.val().trim();if(0===e.length)return n.show(),!1;var t=e,n={action:"everest_forms_new_email_add",source:"email",name:t,id:a.form.data("id"),security:evf_email_params.ajax_email_nonce};s.ajax({url:evf_email_params.ajax_url,data:n,type:"POST",success:function(e){o.addNewEmailConnection(i,{response:e,name:t})}})}},cancel:{text:evf_email_params.i18n_email_cancel}}})},addNewEmailConnection:function(e,n){var t=n.response,n=n.name,i=e.closest(".everest-forms-panel-sidebar-content"),a=s("#everest-forms-panel-field-settings-form_title:first").val()+"-"+Date.now(),o=s(".evf-content-email-settings").first().clone();s(".evf-content-email-settings-inner").removeClass("active-connection"),o.find('input:not(#qt_everest_forms_panel_field_email_connection_1_evf_email_message_toolbar input[type="button"], .evf_conditional_logic_container input)').val(""),o.find('.evf_conditional_logic_container input[type="checkbox"]').prop("checked",!1),o.find('.everest-forms-attach-pdf-to-admin-email input[type="checkbox"]').prop("checked",!1),o.find('.everest-forms-csv-file-email-attachments input[type="checkbox"]').prop("checked",!1),o.find('.everest-forms-show-header-in-attachment-pdf-file input[type="checkbox"]').prop("checked",!1),o.find('.everest-forms-file-email-attachments  input[type="checkbox"]').prop("checked",!1),o.find(".everest-forms-show-header-in-attachment-pdf-file").hide(),o.find(".everest-forms-show-pdf-file-name").hide(),o.find(".evf-field-conditional-container").hide(),o.find(".evf-field-conditional-wrapper li:not(:first)").remove(),o.find(".conditional_or:not(:first)").remove(),o.find(".everest-forms-email-name input").val(n),setTimeout(function(){o.find(".evf-field-conditional-input").val("")},2e3),o.find(".evf-content-email-settings-inner").attr("data-connection_id",t.data.connection_id),o.find(".evf-content-email-settings-inner").removeClass("everest-forms-hidden"),o.find(".evf-toggle-switch input").attr("name","settings[email]["+t.data.connection_id+"][enable_email_notification]"),o.find(".evf-toggle-switch input:checkbox").attr("data-connection-id",t.data.connection_id),o.find(".evf-toggle-switch input:checkbox").prop("checked",!0),o.find(".evf-toggle-switch input:checkbox").val("1"),s(".evf-content-email-settings .evf-content-section-title").css("display","none"),s(".email-disable-message").remove(),o.find(".email-disable-message").remove(),o.find(".evf-toggle-switch").parents(".evf-content-section-title").css("display","flex"),o.find(".evf-field-conditional-container").attr("data-connection_id",t.data.connection_id),o.find("#everest-forms-panel-field-email-connection_1-connection_name").attr("name","settings[email]["+t.data.connection_id+"][connection_name]"),o.find("#everest-forms-panel-field-email-connection_1-evf_to_email").attr("name","settings[email]["+t.data.connection_id+"][evf_to_email]"),o.find("#everest-forms-panel-field-email-connection_1-evf_to_email").val("{admin_email}"),o.find("#everest-forms-panel-field-email-connection_1-evf_carboncopy").attr("name","settings[email]["+t.data.connection_id+"][evf_carboncopy]"),o.find("#everest-forms-panel-field-email-connection_1-evf_blindcarboncopy").attr("name","settings[email]["+t.data.connection_id+"][evf_blindcarboncopy]"),o.find("#everest-forms-panel-field-email-connection_1-evf_from_name").attr("name","settings[email]["+t.data.connection_id+"][evf_from_name]"),o.find("#everest-forms-panel-field-email-connection_1-evf_from_name").val(evf_email_params.from_name),o.find("#everest-forms-panel-field-email-connection_1-evf_from_email").attr("name","settings[email]["+t.data.connection_id+"][evf_from_email]"),o.find("#everest-forms-panel-field-email-connection_1-evf_from_email").val("{admin_email}"),o.find("#everest-forms-panel-field-email-connection_1-evf_reply_to").attr("name","settings[email]["+t.data.connection_id+"][evf_reply_to]"),o.find("#everest-forms-panel-field-email-connection_1-evf_email_subject").attr("name","settings[email]["+t.data.connection_id+"][evf_email_subject]"),o.find("#everest-forms-panel-field-email-connection_1-evf_email_subject").val(evf_email_params.email_subject),o.find("#everest_forms_panel_field_email_connection_1_evf_email_message").attr("name","settings[email]["+t.data.connection_id+"][evf_email_message]"),o.find("#everest_forms_panel_field_email_connection_1_evf_email_message").val("{all_fields}"),o.find("#everest-forms-panel-field-settingsemailconnection_1-file-email-attachments").attr("name","settings[email]["+t.data.connection_id+"][file-email-attachments]"),o.find("#everest-forms-panel-field-settingsemailconnection_1-file-email-attachments").val(1),o.find("#everest-forms-panel-field-settingsemailconnection_1-file-email-attachments").attr("id","everest-forms-panel-field-settingsemail"+t.data.connection_id+"-file-email-attachments"),o.find('label[for="everest-forms-panel-field-settingsemailconnection_1-file-email-attachments"]').attr("for","everest-forms-panel-field-settingsemail"+t.data.connection_id+"-file-email-attachments"),o.find('input[name="settings[email][connection_1][file-email-attachments]"]').remove(),o.find("#everest-forms-panel-field-settingsemailconnection_1-attach_pdf_to_admin_email").attr("name","settings[email]["+t.data.connection_id+"][attach_pdf_to_admin_email]"),o.find("#everest-forms-panel-field-settingsemailconnection_1-attach_pdf_to_admin_email").val(1),o.find("#everest-forms-panel-field-settingsemailconnection_1-attach_pdf_to_admin_email").attr("id","everest-forms-panel-field-settingsemail"+t.data.connection_id+"-attach_pdf_to_admin_email"),o.find('label[for="everest-forms-panel-field-settingsemailconnection_1-attach_pdf_to_admin_email"]').attr("for","everest-forms-panel-field-settingsemail"+t.data.connection_id+"-attach_pdf_to_admin_email"),o.find('input[name="settings[email][connection_1][attach_pdf_to_admin_email]"]').remove(),o.find("#everest-forms-panel-field-settingsemailconnection_1-csv-file-email-attachments").attr("name","settings[email]["+t.data.connection_id+"][csv-file-email-attachments]"),o.find("#everest-forms-panel-field-settingsemailconnection_1-csv-file-email-attachments").val(1),o.find("#everest-forms-panel-field-settingsemailconnection_1-csv-file-email-attachments").attr("id","everest-forms-panel-field-settingsemail"+t.data.connection_id+"-csv-file-email-attachments"),o.find('label[for="everest-forms-panel-field-settingsemailconnection_1-csv-file-email-attachments"]').attr("for","everest-forms-panel-field-settingsemail"+t.data.connection_id+"-csv-file-email-attachments"),o.find('input[name="settings[email][connection_1][csv-file-email-attachments]"]').remove(),o.find("#everest-forms-panel-field-settingsemailconnection_1-show_header_in_attachment_pdf_file").attr("name","settings[email]["+t.data.connection_id+"][show_header_in_attachment_pdf_file]"),o.find("#everest-forms-panel-field-settingsemailconnection_1-show_header_in_attachment_pdf_file").val(1),o.find("#everest-forms-panel-field-settingsemailconnection_1-show_header_in_attachment_pdf_file").attr("id","everest-forms-panel-field-settingsemail"+t.data.connection_id+"-show_header_in_attachment_pdf_file"),o.find('label[for="everest-forms-panel-field-settingsemailconnection_1-show_header_in_attachment_pdf_file"]').attr("for","everest-forms-panel-field-settingsemail"+t.data.connection_id+"-show_header_in_attachment_pdf_file"),o.find('input[name="settings[email][connection_1][show_header_in_attachment_pdf_file]"]').remove(),o.find("#everest-forms-panel-field-settingsemailconnection_1-pdf_name").attr("name","settings[email]["+t.data.connection_id+"][pdf_name]"),o.find("#everest-forms-panel-field-settingsemailconnection_1-pdf_name").val(a),o.find("#everest-forms-panel-field-settingsemailconnection_1-pdf_name").attr("id","everest-forms-panel-field-settingsemail"+t.data.connection_id+"-pdf_name"),o.find(".everest-forms-attach-pdf-to-admin-email").attr("id","everest-forms-panel-field-settingsemailconnection_"+t.data.connection_id+"-attach_pdf_to_admin_email-wrap"),o.find(".everest-forms-show-header-in-attachment-pdf-file ").attr("id","everest-forms-panel-field-settingsemailconnection_"+t.data.connection_id+"-show_header_in_attachment_pdf_file-wrap"),o.find("#everest-forms-panel-field-email-connection_1-conditional_logic_status").attr("name","settings[email]["+t.data.connection_id+"][conditional_logic_status]"),o.find('.evf_conditional_logic_container input[type="hidden"]').attr("name","settings[email]["+t.data.connection_id+"][conditional_logic_status]"),o.find(".evf-field-show-hide").attr("name","settings[email]["+t.data.connection_id+"][conditional_option]"),o.find(".evf-field-conditional-field-select").attr("name","settings[email]["+t.data.connection_id+"][conditionals][1][1][field]"),o.find(".evf-field-conditional-condition").attr("name","settings[email]["+t.data.connection_id+"][conditionals][1][1][operator]"),o.find(".evf-field-conditional-input").attr("name","settings[email]["+t.data.connection_id+"][conditionals][1][1][value]"),$cloned_email=o.append('<input type="hidden" name="settings[email]['+t.data.connection_id+'][connection_name]" value="'+n+'">'),s(".evf-email-settings-wrapper").append(o),i.find(".evf-content-email-settings-inner").last().addClass("active-connection"),e.parent().find(".everest-forms-active-email-connections-list li").removeClass("active-user"),e.closest(".everest-forms-active-email.active").children(".everest-forms-active-email-connections-list").removeClass("empty-list"),e.parent().find(".everest-forms-active-email-connections-list ").append('<li class="connection-list active-user" data-connection-id= "'+t.data.connection_id+'"><a class="user-nickname" href="#">'+n+'</a><a href="#"><span class="email-remove">Remove</span></a></li>')},selectActiveAccount:function(e,n){n.preventDefault();var n=s(e),e=n.data("connection-id"),e=s(".evf-content-email-settings").find('[data-connection_id="'+e+'"]'),t=s(e).length;s(".evf-content-email-settings").find(".evf-content-email-settings-inner").removeClass("active-connection"),s(".evf-content-section-title").has("[data-connection-id="+n.siblings(".active-user").attr("data-connection-id")+"]").css("display","none"),n.siblings().removeClass("active-user"),n.addClass("active-user"),t&&s(e).addClass("active-connection"),s(".email-disable-message").remove(),0==s("input[data-connection-id="+n.attr("data-connection-id")+"]:last").prop("checked")&&s('<p class="email-disable-message everest-forms-notice everest-forms-notice-info">'+evf_data.i18n_email_disable_message+"</p>").insertAfter(s(".evf-content-section-title").has("[data-connection-id="+n.attr("data-connection-id")+"]")),s(".evf-content-section-title").has("[data-connection-id="+n.attr("data-connection-id")+"]").css("display","flex")},removeAccount:function(e,n){n.preventDefault();var t=s(e),i=t.parent().parent().data("connection-id"),a=s(".evf-content-email-settings").find('[data-connection_id="'+i+'"]'),o=s(a).length;s.confirm({title:!1,content:"Are you sure you want to delete this Email?",backgroundDismiss:!1,closeIcon:!1,icon:"dashicons dashicons-info",type:"orange",buttons:{confirm:{text:evf_email_params.i18n_email_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){var e;o&&(e=t.parent().parent(),active_block_after=s(".evf-provider-connections").find('[data-connection_id="'+i+'"]'),lengthOfActiveBlockAfter=s(a).length,(e.prev().length?e.prev(".connection-list"):e.next(".connection-list")).trigger("click"),s(a).parent().remove(),e.remove())}},cancel:{text:evf_email_params.i18n_email_cancel}}})},removeDefaultAccount:function(e,n){n.preventDefault,s.alert({title:!1,content:"Default Email can not be deleted !",icon:"dashicons dashicons-info",type:"blue",buttons:{ok:{text:evf_data.i18n_ok,btnClass:"btn-confirm",keys:["enter"]}}})},focusConnectionName:function(e,n){e=s(e);e.data("val",e.val().trim())},renameConnection:function(e,n){n.preventDefault;var t=s(e),n=t.closest(".evf-content-email-settings-inner").data("connection_id");($active_block=s(".everest-forms-active-email-connections-list").find('[data-connection-id="'+n+'"]')).find(".user-nickname").text(t.val()),0===t.val().trim().length&&(t.parent(".everest-forms-email-name").find(".everest-forms-error").remove(),t.parent(".everest-forms-email-name").append('<p class="everest-forms-error everest-forms-text-danger">Email name cannot be empty.</p>'),t.next(".everest-forms-error").fadeOut(3e3),setTimeout(function(){0===t.val().length&&(t.val(t.data("val")),$active_block.find(".user-nickname").text(t.data("val")))},3e3))}};o.init()}(jQuery);