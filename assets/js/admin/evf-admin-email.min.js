!function(c){var s,n={settings:{form:c("#everest-forms-builder-form"),spinner:'<i class="evf-loading evf-loading-active" />'},init:function(){s=this.settings,c(".everest-forms-active-email-connections-list li").first().addClass("active-user"),c(".evf-content-email-settings-inner").first().addClass("active-connection"),n.bindUIActions()},ready:function(){s.formID=c("#everest-forms-builder-form").data("id")},bindUIActions:function(){c(document).on("click",".everest-forms-email-add",function(e){n.connectionAdd(this,e)}),c(document).on("click",".everest-forms-active-email-connections-list li",function(e){n.selectActiveAccount(this,e)}),c(document).on("click",".email-remove",function(e){n.removeAccount(this,e)}),c(document).on("click",".email-default-remove",function(e){n.removeDefaultAccount(this,e)}),c(document).on("input",".everest-forms-email-name input",function(e){n.renameConnection(this,e)})},connectionAdd:function(e,n){n.preventDefault();var a=c(e),o=a.closest(".everest-forms-panel-sidebar-content"),i=(a.parent(),a.data("type")),t=evf_email_params.i18n_email_connection+('<input autofocus="" type="text" id="provider-connection-name" placeholder="'+evf_email_params.i18n_email_placeholder+'">')+('<p class="error">'+evf_email_params.i18n_email_error_name+"</p>");t=t.replace(/%type%/g,i),c.confirm({title:!1,content:t,icon:"dashicons dashicons-info",type:"blue",backgroundDismiss:!1,closeIcon:!1,buttons:{confirm:{text:evf_email_params.i18n_email_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){var e=this.$content.find("input#provider-connection-name"),n=this.$content.find(".error");if(""===e.val())return n.show(),!1;var i=e.val(),t={action:"everest_forms_new_email_add",source:"email",name:i,id:s.form.data("id"),security:evf_email_params.ajax_email_nonce};c.ajax({url:evf_email_params.ajax_url,data:t,type:"POST",success:function(e){var n=c(".evf-content-email-settings-inner").first().clone();c(".evf-content-email-settings-inner").removeClass("active-connection"),n.find('input:not(#qt_everest_forms_panel_field_email_connection_1_evf_email_message_toolbar input[type="button"], .evf_conditional_logic_container input)').val(""),n.find('.evf_conditional_logic_container input[type="checkbox"]').attr("checked",!1),n.find(".evf-field-conditional-container").hide(),n.find(".evf-field-conditional-wrapper li:not(:first)").remove(),n.find(".conditional_or:not(:first)").remove(),n.find(".everest-forms-email-name input").val(i),setTimeout(function(){n.find(".evf-field-conditional-input").val("")},2e3),n.attr("data-connection_id",e.data.connection_id),n.find("#everest-forms-panel-field-email-connection_1-connection_name").attr("name","settings[email]["+e.data.connection_id+"][connection_name]"),n.find("#everest-forms-panel-field-email-connection_1-evf_to_email").attr("name","settings[email]["+e.data.connection_id+"][evf_to_email]"),n.find("#everest-forms-panel-field-email-connection_1-evf_to_email").attr("value","{admin_email}"),n.find("#everest-forms-panel-field-email-connection_1-evf_carboncopy").attr("name","settings[email]["+e.data.connection_id+"][evf_carboncopy]"),n.find("#everest-forms-panel-field-email-connection_1-evf_blindcarboncopy").attr("name","settings[email]["+e.data.connection_id+"][evf_blindcarboncopy]"),n.find("#everest-forms-panel-field-email-connection_1-evf_from_name").attr("name","settings[email]["+e.data.connection_id+"][evf_from_name]"),n.find("#everest-forms-panel-field-email-connection_1-evf_from_name").attr("value",evf_email_params.from_name),n.find("#everest-forms-panel-field-email-connection_1-evf_from_email").attr("name","settings[email]["+e.data.connection_id+"][evf_from_email]"),n.find("#everest-forms-panel-field-email-connection_1-evf_from_email").attr("value","{admin_email}"),n.find("#everest-forms-panel-field-email-connection_1-evf_reply_to").attr("name","settings[email]["+e.data.connection_id+"][evf_reply_to]"),n.find("#everest-forms-panel-field-email-connection_1-evf_email_subject").attr("name","settings[email]["+e.data.connection_id+"][evf_email_subject]"),n.find("#everest-forms-panel-field-email-connection_1-evf_email_subject").attr("value",evf_email_params.email_subject),n.find("#everest_forms_panel_field_email_connection_1_evf_email_message").attr("name","settings[email]["+e.data.connection_id+"][evf_email_message]"),n.find("#everest_forms_panel_field_email_connection_1_evf_email_message").attr("value","{all_fields}"),n.find("#everest-forms-panel-field-email-connection_1-conditional_logic_status").attr("name","settings[email]["+e.data.connection_id+"][conditional_logic_status]"),n.find('.evf_conditional_logic_container input[type="hidden"]').attr("name","settings[email]["+e.data.connection_id+"][conditional_logic_status]"),n.find(".evf-field-show-hide").attr("name","settings[email]["+e.data.connection_id+"][conditional_option]"),n.find(".evf-field-conditional-field-select").attr("name","settings[email]["+e.data.connection_id+"][conditionals][1][1][field]"),n.find(".evf-field-conditional-condition").attr("name","settings[email]["+e.data.connection_id+"][conditionals][1][1][operator]"),n.find(".evf-field-conditional-input").attr("name","settings[email]["+e.data.connection_id+"][conditionals][1][1][value]"),$cloned_email=n.append('<input type="hidden" name="settings[email]['+e.data.connection_id+'][connection_name]" value="'+i+'">'),c(".evf-content-email-settings").append(n),o.find(".evf-content-email-settings-inner").last().addClass("active-connection"),a.parent().find(".everest-forms-active-email-connections-list li").removeClass("active-user"),a.closest(".everest-forms-active-email.active").children(".everest-forms-active-email-connections-list").removeClass("empty-list"),a.parent().find(".everest-forms-active-email-connections-list ").append('<li class="active-user" data-connection-id= "'+e.data.connection_id+'"><a class="user-nickname" href="#">'+i+'</a><a href="#"><span class="email-remove">Remove</span></a></li>')}})}},cancel:{text:evf_email_params.i18n_email_cancel}}})},selectActiveAccount:function(e,n){n.preventDefault();var i=c(e),t=i.data("connection-id"),a=c(".evf-content-email-settings").find('[data-connection_id="'+t+'"]'),o=c(a).length;c(".evf-content-email-settings").find(".evf-content-email-settings-inner").removeClass("active-connection"),i.siblings().removeClass("active-user"),i.addClass("active-user"),o&&c(a).addClass("active-connection")},removeAccount:function(e,n){n.preventDefault();var i=c(e),t=i.parent().parent().data("connection-id"),a=c(".evf-content-email-settings").find('[data-connection_id="'+t+'"]'),o=c(a).length;c.confirm({title:!1,content:"Are you sure you want to delete this Email?",backgroundDismiss:!1,closeIcon:!1,icon:"dashicons dashicons-info",type:"orange",buttons:{confirm:{text:evf_email_params.i18n_email_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){if(o){var e=i.parent().parent();active_block_after=c(".evf-provider-connections").find('[data-connection_id="'+t+'"]'),lengthOfActiveBlockAfter=c(a).length,e.prev().length?e.prev(".connection-list").trigger("click"):e.next(".connection-list").trigger("click"),c(a).remove(),e.remove()}}},cancel:{text:evf_email_params.i18n_email_cancel}}})},removeDefaultAccount:function(e,n){n.preventDefault,c.alert({title:!1,content:"Default Email can not be deleted !",icon:"dashicons dashicons-info",type:"blue",buttons:{ok:{text:evf_data.i18n_ok,btnClass:"btn-confirm",keys:["enter"]}}})},renameConnection:function(e,n){n.preventDefault;var i=c(e),t=i.closest(".evf-content-email-settings-inner").data("connection_id");$active_block=c(".everest-forms-active-email-connections-list").find('[data-connection-id="'+t+'"]'),$active_block.find(".user-nickname").text(i.val())}};n.init()}(jQuery);