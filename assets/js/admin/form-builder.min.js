!function(m,p){var i,u={init:function(){m(document).ready(function(e){e("evf-panel-integrations-button a").hasClass("active")||(e("#everest-forms-panel-integrations").find(".everest-forms-panel-sidebar a").first().addClass("active"),e("#everest-forms-panel-integrations").find(".everest-forms-panel-sidebar a").hasClass("active")&&e("#everest-forms-panel-integrations").find(".everest-forms-panel-sidebar a").next(".everest-forms-active-connections").first().addClass("active"),e(".everest-forms-panel-content").find(".evf-panel-content-section").first().addClass("active"))}),m(document).ready(function(e){e("evf-panel-payments-button a").hasClass("active")||(e("#everest-forms-panel-payments").find(".everest-forms-panel-sidebar a").first().addClass("active"),e(".everest-forms-panel-content").find(".evf-payment-setting-content").first().addClass("active"))}),m(document.body).on("click","#copy-shortcode",this.copyShortcode).on("aftercopy","#copy-shortcode",this.copySuccess).on("aftercopyfailure","#copy-shortcode",this.copyFail),m(document).ready(u.ready),m(window).on("load",u.load),m(document.body).on("evf-init-builder-fields",function(){u.bindFields()}).trigger("evf-init-builder-fields"),m(document.body).on("adjust_builder_width",function(){var e=m("#adminmenuwrap").width();m("#everest-forms-builder-form").css({width:"calc(100% - "+e+"px)"})}).trigger("adjust_builder_width"),m(document.body).on("click","#collapse-button",function(){m("#everest-forms-builder-form").width(""),m(document.body).trigger("adjust_builder_width")}),m(window).on("resize orientationchange",function(){var e;clearTimeout(e),e=setTimeout(function(){m("#everest-forms-builder").width(""),m(document.body).trigger("adjust_builder_width")},250)}).trigger("resize")},copyShortcode:function(e){evfClearClipboard(),evfSetClipboard(m(".evf-shortcode-field").find("input").val(),m(this)),e.preventDefault()},copySuccess:function(){m("#copy-shortcode").tooltipster("content",m(this).attr("data-copied")).trigger("mouseenter").on("mouseleave",function(){var e=m(this);setTimeout(function(){e.tooltipster("content",e.attr("data-tip"))},1e3)})},copyFail:function(){m(".evf-shortcode-field").find("input").focus().select()},load:function(){m(".everest-forms-overlay").fadeOut()},ready:function(){if(i=m("#everest-forms-builder"),u.bindUIActions(),jconfirm.defaults={closeIcon:!0,backgroundDismiss:!0,escapeKey:!0,animationBounce:1,useBootstrap:!1,theme:"modern",boxWidth:"400px",columnClass:"evf-responsive-class"},"undefined"!=typeof PerfectScrollbar){var e=m(".everest-forms-tab-content"),t=m("#everest-forms-panel-settings .everest-forms-panel-sidebar");1<=e.length&&(window.evf_tab_scroller=new PerfectScrollbar(e.selector)),1<=t.length&&(window.evf_setting_scroller=new PerfectScrollbar(t.selector))}m(document).trigger("everest_forms_ready")},bindUIActions:function(){u.bindDefaultTabs(),u.checkEmptyGrid(),u.bindFields(),u.bindFormPreview(),u.bindGridSwitcher(),u.bindFieldSettings(),u.bindFieldDelete(),u.bindCloneField(),u.bindSaveOption(),u.bindAddNewRow(),u.bindRemoveRow(),u.bindFormSettings(),u.bindFormEmail(),u.bindFormIntegrations(),u.bindFormPayment(),u.choicesInit(),u.choicesUpdate(),u.bindUIActionsFields(),"field-options"===p.tab&&m(".evf-panel-field-options-button").trigger("click")},bindUIActionsFields:function(){i.on("click",".everest-forms-fields-tab a",function(e){e.preventDefault(),u.fieldTabChoice(m(this).attr("id"))}),i.on("change",".everest-forms-field-option-address input.hide",function(){var e=m(this),t=e.parent().parent().data("field-id"),i=e.parent().parent().data("subfield");m("#everest-forms-field-"+t).find(".everest-forms-"+i).toggleClass("hidden")}),i.on("input",".everest-forms-field-option-row-label input",function(){var e=m(this),t=e.val(),i=e.parent().data("field-id");m("#everest-forms-field-"+i).find(".label-title .text").text(t)}),i.on("input",".everest-forms-field-option-row-description textarea",function(){var e=m(this),t=e.val(),i=e.parent().data("field-id"),s=m("#everest-forms-field-"+i).find(".description");s.hasClass("nl2br")?s.html(t.replace(/\n/g,"<br>")):s.html(t)}),i.on("change",".everest-forms-field-option-row-required input",function(e){var t=m(this).parent().data("field-id");m("#everest-forms-field-"+t).toggleClass("required")}),i.on("change",".everest-forms-field-option-row-confirmation input",function(){var e=m(this).parent().data("field-id");m("#everest-forms-field-"+e).find(".everest-forms-confirm").toggleClass("everest-forms-confirm-enabled everest-forms-confirm-disabled"),m("#everest-forms-field-option-"+e).toggleClass("everest-forms-confirm-enabled everest-forms-confirm-disabled")}),i.on("input",".everest-forms-field-option-row-placeholder input",function(e){var t=m(this),i=t.val(),s=t.parent().data("field-id"),n=m("#everest-forms-field-"+s).find(".primary-input");n.is("select")?i.length?n.find(".placeholder").length?n.find(".placeholder").text(i):n.prepend('<option class="placeholder" selected>'+i+"</option>"):n.find(".placeholder").remove():n.attr("placeholder",i)}),i.on("input",".everest-forms-field-option-address input.placeholder",function(e){var t=m(this),i=t.val(),s=t.parent().parent().data("field-id"),n=t.parent().parent().data("subfield");m("#everest-forms-field-"+s).find(".everest-forms-"+n+" input").attr("placeholder",i)}),i.on("input",".everest-forms-field-option-row-confirmation_placeholder input",function(){var e=m(this),t=e.val(),i=e.parent().data("field-id");m("#everest-forms-field-"+i).find(".secondary-input").attr("placeholder",t)}),i.on("change",".everest-forms-field-option-row-label_hide input",function(){var e=m(this).parent().data("field-id");m("#everest-forms-field-"+e).toggleClass("label_hide")}),i.on("change",".everest-forms-field-option-row-sublabel_hide input",function(){var e=m(this).parent().data("field-id");m("#everest-forms-field-"+e).toggleClass("sublabel_hide")}),i.on("change",".everest-forms-field-option-row-datetime_format select, .everest-forms-field-option-row-format select",function(e){var t=m(this),i=t.val(),s=t.parent().data("field-id");m("#everest-forms-field-"+s).find(".format-selected").removeClass().addClass("format-selected format-selected-"+i),m("#everest-forms-field-option-"+s).find(".format-selected").removeClass().addClass("format-selected format-selected-"+i)})},choicesInit:function(){m("ul.evf-choices-list").sortable({items:"li",axis:"y",cursor:"move",scrollSensitivity:40,helper:"clone",out:function(e){var t=m(e.target).attr("data-field-id");u.choiceChange(t)}})},choiceChange:function(e){var t=m("#everest-forms-field-option-row-"+e+"-choices"),i=m("#everest-forms-field-"+e),s=i.find("ul.primary-input"),n=t.find("ul.evf-choices-list").attr("data-field-type");"select"===n&&(s=i.find("select.primary-input")),s.html(""),m.each(t.find("ul.evf-choices-list").find("li"),function(){var e=m(this).find(".default").attr("type"),t=e?'<input type="'+e+'" disabled="">':"",i=m("<li/>").append(t);"select"===n&&(i=m("<option/>"),m(this).find(".default").is(":checked")&&i.attr("selected","selected")),i.append(m(this).find(".label").val()),m(this).find(".default").is(":checked")&&i.find("input").prop("checked",!0),s.append(i)})},choicesUpdate:function(){m("body").on("click",".evf-choices-list a.add",function(){var e=m(this).closest("li").clone();e.find('input[type="text"]').val("");var t=m(this).closest(".evf-choices-list"),i=t.attr("data-field-id"),s=t.attr("data-next-id");e.find('input[type="checkbox"],input[type="radio"]').prop("checked",!1),e.attr("data-key",s),e.find(".default").attr("name","form_fields["+i+"][choices]["+s+"][default]"),e.find(".label").attr("name","form_fields["+i+"][choices]["+s+"][label]"),e.find(".value").attr("name","form_fields["+i+"][choices]["+s+"][value]"),m(this).closest("li").after(e),s++,m(this).closest(".evf-choices-list").attr("data-next-id",s),u.choiceChange(i)}),m("body").on("click",".evf-choices-list a.remove",function(){var e=m(this).closest(".evf-choices-list"),t=e.attr("data-field-id");e.find("li").length<2?m.alert({title:!1,content:p.i18n_field_error_choice,icon:"dashicons dashicons-info",type:"blue",buttons:{ok:{text:p.i18n_ok,btnClass:"btn-confirm",keys:["enter"]}}}):(m(this).closest("li").remove(),u.choiceChange(t))});m("body").on("keyup paste click",".evf-choices-list input",function(){var e=m(this).closest(".evf-choices-list").attr("data-field-id");"radio"===m(this).attr("type").toLowerCase()&&m(this).is(":checked")&&(m(this).closest(".evf-choices-list").find('input[type="radio"]').prop("checked",!1),m(this).prop("checked",!0)),u.choiceChange(e)})},bindFormSettings:function(){m("body").on("click",".evf-setting-panel",function(e){var t=m(this).attr("data-section");m(".evf-setting-panel").removeClass("active"),m(".everest-forms-active-email").removeClass("active"),m(".evf-content-section").removeClass("active"),m(this).addClass("active"),m(".evf-content-"+t+"-settings").addClass("active"),e.preventDefault()}),m(".evf-setting-panel").eq(0).trigger("click")},bindFormEmail:function(){m("body").on("click",".everest-forms-panel-sidebar-section-email",function(e){m(this).siblings(".everest-forms-active-email").removeClass("active"),m(this).next(".everest-forms-active-email").addClass("active");var t=m(this).siblings(".everest-forms-active-email.active").find(".everest-forms-active-email-connections-list li");t.length&&t.children(".user-nickname").first().trigger("click"),e.preventDefault()})},bindFormIntegrations:function(){m("body").on("click",".evf-integrations-panel",function(e){var t=m(this).attr("data-section");m(".evf-integrations-panel").removeClass("active"),m("#everest-forms-panel-integrations").find(".evf-panel-content-section").removeClass("active"),m(this).addClass("active"),m(this).parent().find(".everest-forms-active-connections").removeClass("active"),m(this).next(".everest-forms-active-connections").addClass("active");var i=m(this).siblings(".everest-forms-active-connections.active").find(".everest-forms-active-connections-list li");i.length&&i.children(".user-nickname").first().trigger("click"),m(".evf-panel-content-section-"+t).addClass("active"),e.preventDefault()}),m(".evf-setting-panel").eq(0).trigger("click")},bindFormPayment:function(){m("body").on("click",".evf-payments-panel",function(e){var t=m(this).attr("data-section");m(".evf-payments-panel").removeClass("active"),m(this).siblings().removeClass("icon active"),m(this).addClass("active"),m(this).parents("#everest-forms-panel-payments").find(".evf-payment-setting-content").removeClass("active").hide(),m(".evf-content-"+t+"-settings").addClass("active").show(),e.preventDefault()}),m(".evf-setting-panel").eq(0).trigger("click")},removeRow:function(e){m.each(e.find(".everest-forms-field"),function(){var e=m(this).attr("data-field-id"),t=m("#everest-forms-field-option-"+e);m(this).remove(),t.remove()}),e.remove()},bindRemoveRow:function(){m("body").on("click",".evf-delete-row",function(){var e=m(this),t=m(".evf-admin-row").length,i=e.closest(".evf-admin-row"),s=e.parents(".evf-admin-field-container").attr("data-current-part"),n=m("#everest-forms-builder").hasClass("multi-part-activated");s&&n&&(t=m("#part_"+s).find(".evf-admin-row").length),t<2?m.alert({title:p.i18n_row_locked,content:p.i18n_row_locked_msg,icon:"dashicons dashicons-info",type:"blue",buttons:{confirm:{text:p.i18n_close,btnClass:"btn-confirm",keys:["enter"]}}}):m.confirm({title:!1,content:p.i18n_delete_row_confirm,type:"red",closeIcon:!1,backgroundDismiss:!1,icon:"dashicons dashicons-warning",buttons:{confirm:{text:p.i18n_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){u.removeRow(i)}},cancel:{text:p.i18n_cancel}}})})},bindAddNewRow:function(){m("body").on("click",".evf-add-row span",function(){var e=m(this),t=m(".evf-admin-field-wrapper"),i=m(".evf-admin-row").eq(0).clone(),s=e.parent().attr("data-total-rows"),n=e.parents(".evf-admin-field-container").attr("data-current-part");s++,n&&(t=m(".evf-admin-field-wrapper").find("#part_"+n)),i.find(".evf-admin-grid").html(""),i.attr("data-row-id",s),e.parent().attr("data-total-rows",s),t.append(i),u.bindFields(),u.checkEmptyGrid()})},bindCloneField:function(){m("body").on("click",".everest-forms-preview .everest-forms-field .everest-forms-field-duplicate",function(){var e=m(this).closest(".everest-forms-field");e.hasClass("no-duplicate")?m.alert({title:p.i18n_field_locked,content:p.i18n_field_locked_msg,icon:"dashicons dashicons-info",type:"blue",buttons:{confirm:{text:p.i18n_close,btnClass:"btn-confirm",keys:["enter"]}}}):m.confirm({title:!1,content:p.i18n_duplicate_field_confirm,type:"orange",closeIcon:!1,backgroundDismiss:!1,icon:"dashicons dashicons-warning",buttons:{confirm:{text:p.i18n_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){u.cloneFieldAction(e)}},cancel:{text:p.i18n_cancel}}})})},cloneFieldAction:function(s){var n=s.attr("data-field-id"),e=p.form_id,t={action:"everest_forms_get_next_id",security:p.evf_get_next_id,form_id:e};m.ajax({url:p.ajax_url,data:t,type:"POST",beforeSend:function(){m(document.body).trigger("init_field_options_toggle")},success:function(e){if("boolean"==typeof e.success&&!0===e.success){var t=e.data.field_id,i=e.data.field_key;m("#everest-forms-field-id").val(t),u.render_node(s,n,i),m(document.body).trigger("init_field_options_toggle")}}})},render_node:function(e,n,a){var t=m(".everest-forms-field-options #everest-forms-field-option-"+n),i=m("#everest-forms-field-option-"+n+"-label").val(),s=m("#everest-forms-field-option-"+n+"-meta-key").val(),o=e.attr("data-field-type"),r=t.html(),d=i+" "+p.i18n_copy,l="html"!==o?s.replace(/\(|\)/g,"").toLowerCase().substring(0,s.lastIndexOf("_"))+"_"+Math.floor(1e3+9e3*Math.random()):"",f=e.clone(),c=new RegExp(n,"g");r=r.replace(c,a);var v=m('<div class="everest-forms-field-option everest-forms-field-option-'+o+'" id="everest-forms-field-option-'+a+'" data-field-id="'+a+'" />');v.append(r),m.each(t.find(":input"),function(){var e=m(this).attr("type"),t=m(this).attr("name").replace(c,a),i="";if("text"===e||"hidden"===e)i=m(this).val(),v.find('input[name="'+t+'"]').val(i),v.find('input[value="'+n+'"]').val(a);else if("checkbox"===e||"radio"===e)m(this).is(":checked")?v.find('input[name="'+t+'"]').prop("checked",!0).attr("checked","checked"):v.find('[name="'+t+'"]').prop("checked",!1).attr("checked",!1);else if(m(this).is("select")){if(m(this).find("option:selected").length){var s=m(this).find("option:selected").val();v.find('[name="'+t+'"]').find('[value="'+s+'"]').prop("selected",!0)}}else""!==m(this).val()&&v.find('[name="'+t+'"]').val(m(this).val())}),m(".everest-forms-field-options").append(v),m("#everest-forms-field-option-"+a+"-label").val(d),m("#everest-forms-field-option-"+a+"-meta-key").val(l),f.attr("class",e.attr("class")),f.attr("id","everest-forms-field-"+a),f.attr("data-field-id",a),f.attr("data-field-type",o),f.find(".label-title .text").text(d),e.closest(".evf-admin-grid").find('[data-field-id="'+n+'"]').after(f),m(document).trigger("everest-form-cloned",[a,o]),u.switchToFieldOptionPanel(a)},bindFieldDelete:function(){m("body").on("click",".everest-forms-preview .everest-forms-field .everest-forms-field-delete",function(){var t=m(this).closest(".everest-forms-field"),e=t.attr("data-field-id"),i=m("#everest-forms-field-option-"+e);m(this).closest(".evf-admin-grid");t.hasClass("no-delete")?m.alert({title:p.i18n_field_locked,content:p.i18n_field_locked_msg,icon:"dashicons dashicons-info",type:"blue",buttons:{confirm:{text:p.i18n_close,btnClass:"btn-confirm",keys:["enter"]}}}):m.confirm({title:!1,content:p.i18n_delete_field_confirm,type:"red",closeIcon:!1,backgroundDismiss:!1,icon:"dashicons dashicons-warning",buttons:{confirm:{text:p.i18n_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){m(".evf-panel-fields-button").trigger("click"),t.fadeOut("slow",function(){var e=t.attr("data-field-id");m(document.body).trigger("evf_before_field_deleted",[e]),t.remove(),i.remove(),u.checkEmptyGrid(),m(".everest-forms-fields-tab").find("a").removeClass("active"),m(".everest-forms-fields-tab").find("a").first().addClass("active"),m(".everest-forms-add-fields").show(),u.conditionalLogicRemoveField(e),u.conditionalLogicRemoveFieldIntegration(e)})}},cancel:{text:p.i18n_cancel}}})})},bindSaveOption:function(){m("body").on("click",".everest-forms-save-button",function(){var t=m(this),e=m("form#everest-forms-builder-form"),i=u.getStructure(),s=e.serializeArray();e.triggerHandler("everest_forms_process_ajax_data",[t,s])&&(s=e.triggerHandler("everest_forms_process_ajax_data",[t,s])),m(".everest-forms-panel-content-wrap").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var n=s.concat(i),a={action:"everest_forms_save_form",security:p.evf_save_form,form_data:JSON.stringify(n)};m.ajax({url:p.ajax_url,data:a,type:"POST",beforeSend:function(){t.addClass("processing"),t.find(".loading-dot").remove(),t.append('<span class="loading-dot"></span>')},success:function(e){t.removeClass("processing"),t.find(".loading-dot").remove(),e.success||m.alert({title:e.data.errorTitle,content:e.data.errorMessage,icon:"dashicons dashicons-warning",type:"red",buttons:{ok:{text:p.i18n_ok,btnClass:"btn-confirm",keys:["enter"]}}}),m(".everest-forms-panel-content-wrap").unblock()}})})},getStructure:function(){var e=m(".evf-admin-field-wrapper"),a=[];return m.each(e.find(".evf-admin-row"),function(){var e=m(this),n=e.attr("data-row-id");m.each(e.find(".evf-admin-grid"),function(){var e=m(this),i=e.attr("data-grid-id"),s=0;m.each(e.find(".everest-forms-field"),function(){var e={name:"",value:""},t=m(this).attr("data-field-id");e.name="structure[row_"+n+"][grid_"+i+"]["+s+"]",s++,e.value=t,a.push(e)}),e.find(".everest-forms-field").length<1&&a.push({name:"structure[row_"+n+"][grid_"+i+"]",value:""})})}),a},getFieldArray:function(e){var t=[];return m.each(e.find(".everest-forms-field"),function(){var e=m(this).attr("data-field-id");t.push(e)}),t},checkEmptyGrid:function(e){m.each(m(".evf-admin-grid"),function(){m(this).find(".everest-forms-field, .evf-registered-item:not(.ui-draggable-dragging)").not(".ui-sortable-helper").length<1?m(this).addClass("evf-empty-grid"):m(this).removeClass("evf-empty-grid")}),u.choicesInit()},bindDefaultTabs:function(){m(document).on("click",".evf-nav-tab-wrapper a",function(e){e.preventDefault(),u.switchTab(m(this).data("panel"))})},switchTab:function(e){var t=m("#everest-forms-panel-"+e),i=m(".evf-panel-"+e+"-button");m(".evf-nav-tab-wrapper").find("a").removeClass("nav-tab-active"),i.addClass("nav-tab-active"),t.closest(".evf-tab-content").find(".everest-forms-panel").removeClass("active"),t.addClass("active"),"integrations"!==e&&"payments"!==e||(t.find(".everest-forms-panel-sidebar a").hasClass("active")||t.find(".everest-forms-panel-sidebar a").first().addClass("active"),m(".everest-forms-panel-content").find(".evf-panel-content-section").hasClass("active")||m(".everest-forms-panel-content").find(".evf-panel-content-section").first().addClass("active")),history.replaceState({},null,u.updateQueryString("tab",e)),u.switchPanel(e)},updateQueryString:function(e,t,i){i=i||window.location.href;var s,n=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(n.test(i))return null!=t?i.replace(n,"$1"+e+"="+t+"$2$3"):(i=(s=i.split("#"))[0].replace(n,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof s[1]&&null!==s[1]&&(i+="#"+s[1]),i);if(null==t)return i;var a=-1!==i.indexOf("?")?"&":"?";return i=(s=i.split("#"))[0]+a+e+"="+t,"undefined"!=typeof s[1]&&null!==s[1]&&(i+="#"+s[1]),i},switchPanel:function(e){"field-options"===e&&u.switchToFieldOptionPanel()},switchToFieldOptionPanel:function(e){m(".everest-forms-field-options").find(".no-fields").hide(),m(".evf-admin-field-wrapper .everest-forms-field").removeClass("active"),m("#everest-forms-panel-fields").addClass("active"),m(".everest-forms-fields-tab").find("a").removeClass("active"),m(".everest-forms-fields-tab").find("a").last().addClass("active"),m(".everest-forms-add-fields").hide(),m(".everest-forms-field-options").show(),m(".everest-forms-field-options").find(".everest-forms-field-option").hide(),m(".evf-tab-lists").find("li a").removeClass("active"),m(".evf-tab-lists").find("li.evf-panel-field-options-button a").addClass("active"),m(document.body).trigger("evf-init-switch-field-options"),void 0!==e?(m("#everest-forms-field-option-"+e).show(),m("#everest-forms-field-"+e).addClass("active")):0<m(".evf-admin-field-wrapper .everest-forms-field").length?(m(".evf-admin-field-wrapper .everest-forms-field").eq(0).addClass("active"),m("#everest-forms-field-option-"+m(".evf-admin-field-wrapper .everest-forms-field").eq(0).attr("data-field-id")).show()):m(".everest-forms-field-options").find(".no-fields").show()},bindFields:function(){m(".evf-admin-field-wrapper").sortable({items:".evf-admin-row",axis:"y",cursor:"move",opacity:.65,scrollSensitivity:40,forcePlaceholderSize:!0,placeholder:"evf-sortable-placeholder",containment:".everest-forms-panel-content",start:function(e,t){t.item.css({"background-color":"#f7fafc",border:"1px dashed #5d96ee"})},stop:function(e,t){t.item.removeAttr("style")}}).disableSelection(),m(".evf-admin-grid").sortable({items:"> .everest-forms-field",delay:100,opacity:.65,cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,connectWith:".evf-admin-grid",containment:".everest-forms-field-wrap",out:function(e){m(".evf-admin-grid").removeClass("evf-hover"),m(e.target).removeClass("evf-item-hover"),m(e.target).closest(".evf-admin-row").removeClass("evf-hover"),u.checkEmptyGrid()},over:function(e,t){m(".evf-admin-grid").addClass("evf-hover"),m(e.target).addClass("evf-item-hover"),m(e.target).closest(".evf-admin-row").addClass("evf-hover"),u.checkEmptyGrid()},receive:function(e,t){t.sender.is("button")&&u.fieldDrop(t.helper)},stop:function(e,t){t.item.removeAttr("style"),u.checkEmptyGrid()}}).disableSelection(),m(".evf-registered-buttons button.evf-registered-item").draggable({delay:200,cancel:!1,scroll:!1,revert:"invalid",scrollSensitivity:40,forcePlaceholderSize:!0,helper:function(){return m(this).clone().insertAfter(m(this).closest(".everest-forms-tab-content").siblings(".everest-forms-fields-tab"))},opacity:.75,containment:"#everest-forms-builder",connectToSortable:".evf-admin-grid"}).disableSelection(),m(".evf-admin-row").on("mouseenter mouseleave",function(e){e.buttons<1&&("mouseenter"===e.type?m(this).addClass("evf-hover"):m(".evf-admin-row").removeClass("evf-hover"))}),m(".everest-forms-panel-content").on("scroll",function(){m(".evf-admin-grid").sortable("refreshPositions"),m(".evf-admin-field-wrapper").sortable("refreshPositions")})},fieldTabChoice:function(e){m(".everest-forms-tab-content").scrollTop(0),m(".everest-forms-fields-tab a").removeClass("active"),m(".everest-forms-field, .everest-forms-title-desc").removeClass("active"),m("#"+e).addClass("active"),"add-fields"===e?(m(".everest-forms-add-fields").show(),m(".everest-forms-field-options").hide()):("field-options"===e?(e=m(".everest-forms-field").first().data("field-id"),m(".everest-forms-field-options").show(),m(".everest-forms-field").first().addClass("active")):m("#everest-forms-field-"+e).addClass("active"),m(".everest-forms-field-option").hide(),m("#everest-forms-field-option-"+e).show(),m(".everest-forms-add-fields").hide())},bindFormPreview:function(){},bindGridSwitcher:function(){m("body").on("click",".evf-show-grid",function(e){e.stopPropagation(),u.checkEmptyGrid(),m(this).closest(".evf-toggle-row").find(".evf-toggle-row-content").stop(!0).slideToggle(200)}),m(document).click(function(){u.checkEmptyGrid(),m(".evf-show-grid").closest(".evf-toggle-row").find(".evf-toggle-row-content").stop(!0).slideUp(200)});m("body").on("click",".evf-grid-selector",function(){var e=m(this).closest(".evf-admin-row");if(!m(this).hasClass("active")){var t=parseInt(m(this).attr("data-evf-grid"),10);if(!(2<t)){var i=m('<div class="evf-admin-grid evf-grid-'+t+' ui-sortable evf-empty-grid" />'),s=m("<div/>");m.each(e.find(".evf-admin-grid"),function(){m(this).children("*").each(function(){s.append(m(this).clone())})}),e.find(".evf-admin-grid").remove(),e.find(".evf-clear ").remove(),e.append('<div class="clear evf-clear"></div>');for(var n=1;n<=t;n++)i.attr("data-grid-id",n),e.append(i.clone());e.append('<div class="clear evf-clear"></div>'),e.find(".evf-admin-grid").eq(0).append(s.html()),e.find(".evf-grid-selector").removeClass("active"),m(this).addClass("active"),u.bindFields()}}})},fieldDrop:function(o){var e=o.attr("data-field-type");o.css({left:"0",width:"100%"}).append('<i class="spinner is-active"></i>'),m.ajax({url:p.ajax_url,type:"POST",data:{action:"everest_forms_new_field_"+e,security:p.evf_field_drop_nonce,field_type:e,form_id:p.form_id},beforeSend:function(){m(document.body).trigger("init_field_options_toggle")},success:function(e){var t=e.data.preview,i=e.data.options,s=e.data.form_field_id,n=m(t).attr("id"),a=m(t).attr("data-field-id");m("#everest-forms-field-id").val(s),m(".everest-forms-field-options").find(".no-fields").hide(),m(".everest-forms-field-options").append(i),m(".everest-forms-field-option-row-icon_color input.colorpicker").wpColorPicker({change:function(e){var t=m(this),i=t.val(),s=t.closest(".everest-forms-field-option-row").data("field-id");m("#everest-forms-field-"+s+" .rating-icon svg").css("fill",i)}}),o.after(t),null!==m("#everest-forms-panel-field-settings-enable_survey")&&m("#everest-forms-panel-field-settings-enable_survey").prop("checked")&&m("#everest-forms-field-option-"+a+"-survey_status").prop("checked",!0),null!==m("#everest-forms-panel-field-settings-enable_quiz")&&m("#everest-forms-panel-field-settings-enable_quiz").prop("checked")&&(m("#everest-forms-field-option-"+a+"-quiz_status").prop("checked",!0),m("#everest-forms-field-option-"+a+"-quiz_status").closest(".everest-forms-field-option-row-quiz_status").siblings(".everst-forms-field-quiz-settings").removeClass("everest-forms-hidden").addClass("everest-forms-show")),o.remove(),u.checkEmptyGrid(),m(document.body).trigger("init_tooltips"),m(document.body).trigger("init_field_options_toggle"),m(document.body).trigger("evf_after_field_append",[n]),u.conditionalLogicAppendField(n),u.conditionalLogicAppendFieldIntegration(n)}})},conditionalLogicAppendField:function(o){var e=m("#"+o),r=e.index(),d=m(".evf-field-conditional-field-select"),l=e.attr("data-field-type"),f=e.attr("data-field-id"),c=e.find(".label-title .text ").text();m.fn.insertAt=function(e,t,i){var s=m.makeArray(this.children().clone(!0));s.splice(t,0,e),m.each(s,function(e,t){i===m(t)[0].value&&(m(t)[0].selected=!0,s[e]=t)}),this.empty().append(s)};var v=f;d.each(function(s,e){var t=m(e).val(),i=o.replace("everest-forms-field-",""),n=m(e).attr("name");if(i===n.substring(n.indexOf("[")+1,n.indexOf("]")))m(".evf-admin-row .evf-admin-grid .everest-forms-field").each(function(){var e=m(this).data("field-type"),t=m(this).data("field-id"),i=m(this).find(".label-title span").first().text();field_to_be_restricted=[],field_to_be_restricted=["html","title","address","image-upload","file-upload","date-time","hidden","scale-rating","likert"],-1===m.inArray(e,field_to_be_restricted)&&v!==t&&d.eq(s).append('<option class="evf-conditional-fields" data-field_type="'+e+'" data-field_id="'+t+'" value="'+t+'">'+i+"</option>")});else{var a='<option class="evf-conditional-fields" data-field_type="'+l+'" data-field_id="'+f+'" value="'+f+'">'+c+"</option>";"html"!==l&&"title"!==l&&"address"!==l&&"image-upload"!==l&&"file-upload"!==l&&"date-time"!==l&&"hidden"!==l&&"likert"!==l&&"scale-rating"!==l&&d.eq(s).insertAt(a,r,t)}})},conditionalLogicAppendFieldIntegration:function(a){var o=m("#"+a),r=o.index(),d=m(".evf-provider-conditional").find(".evf-conditional-field-select"),l=o.attr("data-field-type"),f=o.attr("data-field-id"),c=o.find(".label-title .text ").text();m.fn.insertAt=function(e,t){var i=m.makeArray(this.children().clone(!0));i.splice(t,0,e),this.empty().append(i)},d.each(function(s,e){var t=a.replace("everest-forms-field-",""),i=m(e).attr("name");if(t===i.substring(i.indexOf("[")+1,i.indexOf("]")))m(".evf-admin-row .evf-admin-grid .everest-forms-field").each(function(){var e=m(this).data("field-type"),t=m(this).data("field-id"),i=m(this).find(".label-title span").first().text();field_to_be_restricted=[],field_to_be_restricted=["html","title","address","image-upload","file-upload","date-time","hidden","scale-rating","likert",o.attr("data-field-type")],-1===m.inArray(e,field_to_be_restricted)&&d.eq(s).append('<option class="evf-conditional-fields" data-field_type="'+e+'" data-field_id="'+t+'" value="'+t+'">'+i+"</option>")});else{var n='<option class="evf-conditional-fields" data-field_type="'+l+'" data-field_id="'+f+'" value="'+f+'">'+c+"</option>";"html"!==l&&"title"!==l&&"address"!==l&&"image-upload"!==l&&"file-upload"!==l&&"date-time"!==l&&"hidden"!==l&&"likert"!==l&&"scale-rating"!==l&&d.eq(s).insertAt(n,r)}})},conditionalLogicRemoveField:function(e){m(".evf-field-conditional-field-select option[value = "+e+" ]").remove()},conditionalLogicRemoveFieldIntegration:function(e){m(".evf-provider-conditional .evf-conditional-field-select option[value = "+e+" ]").remove()},bindFieldSettings:function(){m("body").on("click",".everest-forms-preview .everest-forms-field, .everest-forms-preview .everest-forms-field .everest-forms-field-setting",function(e){e.preventDefault();var t=m(this).closest(".everest-forms-field").attr("data-field-id");m(".everest-forms-tab-content").scrollTop(0),u.switchToFieldOptionPanel(t)})}};m(function(){u.init()})}(jQuery,window.evf_data),jQuery(function(){"checked"!=jQuery("#everest-forms-panel-field-settingsemail-evf_send_confirmation_email").attr("checked")&&jQuery("#everest-forms-panel-field-settingsemail-evf_send_confirmation_email-wrap").nextAll().hide(),jQuery("#everest-forms-panel-field-settingsemail-evf_send_confirmation_email").on("change",function(){"checked"!=jQuery(this).attr("checked")?jQuery("#everest-forms-panel-field-settingsemail-evf_send_confirmation_email-wrap").nextAll().hide():jQuery("#everest-forms-panel-field-settingsemail-evf_send_confirmation_email-wrap").nextAll().show()});var e=jQuery("#everest-forms-panel-field-settings-redirect_to option:selected").val();"0"==e?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"1"==e?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").show(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"2"==e&&(jQuery("#everest-forms-panel-field-settings-external_url-wrap").show(),jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide()),jQuery("#everest-forms-panel-field-settings-redirect_to").on("change",function(){"0"==this.value?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"1"==this.value?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").show(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"2"==this.value&&(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").show())}),jQuery(".evf-panel-field-options-button.evf-disabled-tab").hide()}),jQuery(function(f){f(document.body).on("init_add_fields_toogle",function(){f(".everest-forms-add-fields").on("click",".everest-forms-add-fields-group > a",function(e){e.preventDefault(),f(this).parent(".everest-forms-add-fields-group").toggleClass("closed").toggleClass("open")}),f(".everest-forms-add-fields").on("click",".everest-forms-add-fields-group a",function(){f(this).next(".evf-registered-buttons").stop().slideToggle()}),f(".everest-forms-add-fields-group.closed").each(function(){f(this).find(".evf-registered-buttons").hide()})}).trigger("init_add_fields_toogle"),f(document.body).on("init_field_options_toggle",function(){f(".everest-forms-field-option").on("click",".everest-forms-field-option-group > a",function(e){e.preventDefault(),f(this).parent(".everest-forms-field-option-group").toggleClass("closed").toggleClass("open")}),f(".everest-forms-field-option").on("click",".everest-forms-field-option-group a",function(e){f(e.target).filter(":input, option, .sort").length||f(this).next(".everest-forms-field-option-group-inner").stop().slideToggle()}),f(".everest-forms-field-option-group.closed").each(function(){f(this).find(".everest-forms-field-option-group-inner").hide()})}).trigger("init_field_options_toggle"),f(document).click(function(){f(".evf-smart-tag-lists").hide()}),f(document.body).on("click",".evf-toggle-smart-tag-display",function(e){e.stopPropagation(),f(".evf-smart-tag-lists").hide(),f(".evf-smart-tag-lists ul").empty(),f(this).parent().find(".evf-smart-tag-lists").toggle("show");var t=f(this).data("type");!function l(n,e,t){var a=[],o=[],r=[];if(f(".evf-admin-row .evf-admin-grid .everest-forms-field").each(function(){var e=f(this).data("field-type"),t=f(this).data("field-id");if(n===e){var i=f(this).find(".label-title span").first().text();r[t]=i}else{var s=f(this).find(".label-title span").first().text();a[t]=s}o[t]=f(this).find(".label-title span").first().text()}),"other"===e||"all"===e){var i=evf_data.smart_tags_other;for(var s in i)f(t).parent().find(".evf-smart-tag-lists .evf-others").append('<li class = "smart-tag-field" data-type="other" data-field_id="'+s+'">'+i[s]+"</li>")}if("fields"===e||"all"===e)if("email"===n)for(var s in Object.keys(r).length<1?f(t).parent().find('.evf-smart-tag-lists .smart-tag-title:not(".other-tag-title")').addClass("everest-forms-hidden"):f(t).parent().find('.evf-smart-tag-lists .smart-tag-title:not(".other-tag-title")').removeClass("everest-forms-hidden"),f(t).parent().find(".evf-smart-tag-lists .other-tag-title").remove(),f(t).parent().find(".evf-smart-tag-lists .evf-others").remove(),f(t).parent().find(".evf-smart-tag-lists").append('<div class="smart-tag-title other-tag-title">Others</div><ul class="evf-others"></ul>'),f(t).parent().find(".evf-smart-tag-lists .evf-others").append('<li class="smart-tag-field" data-type="other" data-field_id="admin_email">Site Admin Email</li><li class="smart-tag-field" data-type="other" data-field_id="user_email">User Email</li>'),r)f(t).parent().find(".evf-smart-tag-lists .evf-fields").append('<li class = "smart-tag-field" data-type="field" data-field_id="'+s+'">'+r[s]+"</li>");else for(var d in Object.keys(o).length<1?f(t).parent().find('.evf-smart-tag-lists .smart-tag-title:not(".other-tag-title")').addClass("everest-forms-hidden"):f(t).parent().find('.evf-smart-tag-lists .smart-tag-title:not(".other-tag-title")').removeClass("everest-forms-hidden"),o)f(t).parent().find(".evf-smart-tag-lists .evf-fields").append('<li class = "smart-tag-field" data-type="field" data-field_id="'+d+'">'+o[d]+"</li>")}(f(this).data("fields"),t,f(this))}),f(document.body).on("change",".everest-forms-toggle-form input",function(e){e.stopPropagation(),f.post(evf_data.ajax_url,{action:"everest_forms_enabled_form",security:evf_data.evf_enabled_form,form_id:f(this).data("form_id"),enabled:f(this).attr("checked")?1:0})}),f(document.body).on("click",".smart-tag-field",function(e){var t=f(this).data("field_id"),i=f(this).text(),s=f(this).data("type"),n=f(this).parent().parent().parent(),a=n.find("input[type=text]"),o=n.find("textarea");if("fullname"!==t&&"email"!==t&&"subject"!==t&&"message"!==t&&"other"!==s){i=i.split(/[\s-_]/);for(var r=0;r<i.length;r++)i[r]=0===r?i[r].charAt(0).toLowerCase()+i[r].substr(1):i[r].charAt(0).toUpperCase()+i[r].substr(1);t=(i=i.join(""))+"_"+t}else t=t;"field"===s?(a.val(a.val()+'{field_id="'+t+'"}'),o.val(o.val()+'{field_id="'+t+'"}')):"other"===s&&(a.val(a.val()+"{"+t+"}"),o.val(o.val()+"{"+t+"}"))}),f(document).on("change",".evf-content-email-settings .evf-toggle-switch input",function(e){var t=f(this),i=t.prop("checked");!1===i?(f(this).closest("#everest-forms-panel-settings").find(".everest-forms-active-email").addClass("everest-forms-hidden"),t.closest(".evf-content-email-settings").find(".email-disable-message").remove(),t.closest(".evf-content-section-title").siblings(".evf-content-email-settings-inner").addClass("everest-forms-hidden"),f('<p class="email-disable-message everest-forms-notice everest-forms-notice-info">'+evf_data.i18n_email_disable_message+"</p>").insertAfter(t.closest(".evf-content-section-title"))):!0===i&&(f(this).closest("#everest-forms-panel-settings").find(".everest-forms-active-email").removeClass("everest-forms-hidden"),t.closest(".evf-content-section-title").siblings(".evf-content-email-settings-inner").removeClass("everest-forms-hidden"),t.closest(".evf-content-email-settings").find(".email-disable-message").remove())})});